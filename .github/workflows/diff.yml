name: GitHub Actions Diff
run-name: Regularly Scheduled GitHub Actions 🚀 Diff Workflow
on:
  push:
  schedule:
    - cron: '39 9 * * *'
    - cron: '39 9 * * *'
jobs:
  Diff-ads-txt:
    runs-on: ubuntu-latest
    outputs:
      output1: ${{ steps.diff-adstxt-files.outputs.DIFF_OUT }}
    steps:
      - run: echo "🎉 The job was automatically triggered by scheduled cron event."
      - run: echo "🐧 This job is now running on a ${{ runner.os }} server hosted by GitHub!"
      - run: echo "🔎 Attempting to diff url contents"
      - name: Diff
        continue-on-error: true
        id: diff-adstxt-files
        # https://trstringer.com/github-actions-multiline-strings/
        run: |
          DIFF_OUT=$(cat << EOF
          `diff <(curl https://config.playwire.com/dyn_ads/1025030/74482/ads.txt) <(curl https://pvpivs.com/ads.txt)`          EOF
          )
          echo "DIFF_OUT<<EOF" >> $GITHUB_OUTPUT
          echo "$DIFF_OUT" >> $GITHUB_OUTPUT
          echo "EOF" >> $GITHUB_OUTPUT
      - run: echo "💡 Diff completed, diff status is ${{ steps.diff-adstxt-files.conclusion }} and outcome is ${{ steps.diff-adstxt-files.outcome }}."
      - run: echo "🍏 This job's status is ${{ job.status }}."
  Diff-status:
    needs: Diff-ads-txt
    runs-on: ubuntu-latest
    steps:
      - run: echo "The diff failed with ${{needs.Diff-ads-txt.outputs.output1}}, proceeding to replace ads.txt"
      - run: echo "🍏 This job's status is ${{ job.status }}."
      # https://github.com/marketplace/actions/push-a-file-to-another-repository
