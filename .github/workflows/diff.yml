name: GitHub Actions Diff
run-name: Regularly Scheduled GitHub Actions üöÄ Diff Workflow
on:
  push:
  schedule:
    - cron: '39 9 * * *'
    - cron: '39 9 * * *'
jobs:
  Diff-ads-txt:
    runs-on: ubuntu-latest
    outputs:
      output1: ${{ steps.diff-adstxt-files.outputs.result }}
    steps:
      - run: echo "üéâ The job was automatically triggered by scheduled cron event."
      - run: echo "üêß This job is now running on a ${{ runner.os }} server hosted by GitHub!"
      - run: echo "üîé Attempting to diff url contents"
      - name: Diff
        continue-on-error: true
        id: diff-adstxt-files
        run: echo "result=(diff <(curl https://config.playwire.com/dyn_ads/1025030/74482/ads.txt) <(curl https://pvpivs.com/ads.txt))" >> "$GITHUB_OUTPUT"
      - run: echo "üí° The diff command has completed, diff status is ${{ steps.diff-adstxt-files.conclusion }} and outcome is ${{ steps.diff-adstxt-files.outcome }}."
      - run: echo "üçè This job's status is ${{ job.status }}."

  Diff-failed:
    needs: Diff-ads-txt
    # https://github.com/marketplace/actions/push-a-file-to-another-repository
    runs-on: ubuntu-latest
    if: jobs.Diff-ads-txt.steps.diff-adstxt-files.outcome == 'failure'
    steps:
      - env:
        OUTPUT1: ${{needs.Diff-ads-txt.outputs.output1}}
      - run: echo "The diff failed with $OUTPUT1, proceeding to replace ads.txt"
      #- name: Checkout
      #  uses: actions/checkout@v2
    
      #- name: Pushes new ads.txt
      #  uses: DeathbyToast/PvP_IVs/tree/gh-pages
      #env:
      #  API_TOKEN_GITHUB: ${{ secrets.API_TOKEN_GITHUB }}
      #with:
      #  source_file: curl https://config.playwire.com/dyn_ads/1025030/74482/ads.txt
      #  destination_repo: DeathbyToast/PvP_IVs/tree/gh-pages
      #  destination_folder: ./
      #  user_email: 'alex.gronbach@gmail.com'
      #  user_name: 'DeathbyToast'
      #  commit_message: 'Overwrtiting ads.txt due to diff mismatch'
    - run: echo "üçè This job's status is ${{ job.status }}."
