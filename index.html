<!DOCTYPE html>
<html lang="en-US">
  <head>
    <!-- Google Tag Manager -->
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
    j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
    'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-TDF58VB');</script>
    <!-- End Google Tag Manager -->
    <meta charset="UTF-8">
    <link rel="canonical" href="https://pvpivs.com/" />
    <!-- Include pre-loads to reduce/optimize page load time-->
    <link rel="preload" href="https://pvpivs.com/includes/style.css" as="style">
    <link rel="preload" href="https://pvpivs.com/includes/footer.js" as="script">
    <link rel="preload" href="https://pvpivs.com/includes/calculate.js" as="script">
    <link rel="preload" href="https://pvpivs.com/includes/pokeListAA.js" as="script">
    <title>PvP IVs - Rankings</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="PvP IVs lookup tool for Pok&eacute;mon Go&trade; to help compare your Pok&eacute;mon's PvP IVs to ideal PvP IVs. Finds PvP IVs for any wild-caught, weather boosted, traded, raided, hatched, and even purified Pok&eacute;mon! Did you catch the very best?"/>
    <link rel=icon href=/includes/favicon.png>
    <link rel="stylesheet" href="https://pvpivs.com/includes/style.css">
    <style>
      /* control highlight of trading improvement rows based on % chace to improve post-trade
       * also controls the output row highlighting for user entered IVs (#outTable)
       * 1000/4096 ~= 0.2442 and 100/4096 ~= 0.02442
       * use 0.02442 to approximate "Top 100" (green) when there are less than 4096 results
       * use 0.2442 to approximate "Top 1000" (orange) when there are less than 4096 results */
      #outTable tr.good > *, #familyTable tr.good > *, #tradeTable tr.highMaxRow > * {background-color: var(--goodResult); color: var(--navActiveText);}
      #outTable tr.ok > *, #familyTable tr.ok > *, #tradeTable tr.okMaxRow > * {background-color: var(--okResult); color: var(--navActiveText);}
      #outTable tr.rubbish > *, #familyTable tr.rubbish > *, #tradeTable tr.lowMaxRow > * {background-color: var(--badResult); color: var(--navActiveText);}
      /* the > * operator applies the css to all children (cells) */
      #outTable, #familyTable a {
        color: var(--navActiveText);
      }
      
      input[type=number] {
        width: 44px;
      }
      input[id=pokeInput] {
        width: 111px;
      }
      /* Plus/Minus Buttons */
      /* https://stackoverflow.com/q/33766350 */
      .circle {
        border: 1px solid var(--navBackground);
        box-shadow: inset 1px 1px 1px var(--tableDividers);
        width: 18px;
        height: 18px;
        border-radius: 100%;
        position: relative;
        margin: 4px;
        display: inline-block;
        vertical-align: middle;
        background: #aaaaaa4f;
      }
      .circle:hover{
        background: radial-gradient(var(--textBoxBg), var(--tableHeaderBg));
      }
      .circle:active{
        background: var(--navActive);
      }
      .circle:before,.circle:after{
        content:'';position:absolute;top:0;left:0;right:0;bottom:0;
      }
      /* PLUS */
      .circle.plus:before,.circle.plus:after {
        background:green;
      }
      .circle.plus:before{
        width: 2px;
        margin: 3px auto;
      }
      .circle.plus:after{
        margin: auto 3px;
        height: 2px;
      }
      /* MINUS */
      .circle.minus:before{
        background: #cc0000;
        margin: auto 3px;
        height: 2px;
      }
      #resetButton {
        color: var(--secondary);
        background-color: var(--textBoxBg);
        font-weight : bold;
      }
      #totalRanks {
        display: inline;
      }
    </style>
  </head>
  <body class="light-theme" onload="checkURI()">
    <!-- Google Tag Manager (noscript) -->
    <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-TDF58VB"
    height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <!-- End Google Tag Manager (noscript) -->
    <header>
      <ul class="header">
        <li class="dropdown active left">
          <a href="javascript:void(0)" class="dropbtn active">PvP IVs</a>
          <div class="dropdown-content">
            <a href="/" class="active">Rankings (Single)</a>
            <a href="/leagueRanks.html">Rankings (League)</a>
            <a href="/searchStr.html">Search Strings</a>
          </div>
        </li>
        <li class="dropdown left">
          <a href="javascript:void(0)" class="dropbtn">Typing</a>
          <div class="dropdown-content">
            <a href="/typeLookup.html">Chart</a>
            <a href="/typeQuiz.html">Quiz</a>
          </div>
        </li>
        <li class="flat right">
          <a href="/about.html">About</a>
        </li>
        <li class="flat right">
            <label class="theme-toggle-switch">
              <img id="theme-toggle-icon" src="https://pvpivs.com/includes/dark_mode_icon_white-fill.png" alt="Dark Mode" width="22" height="22">
              <div>
                <input id="theme-toggle" type="checkbox" />
                <span class="slider round"></span>
              </div>
            </label>
          </li>
      </ul>
    </header>
    <br />
    <section>
      <label>Top <input type="number" value="10" id="limit" min="1" max="4096" oninput="setUserPreference('limit')"></label>
      <label><select id="league" oninput="setUserPreference('league')">
        <option value="500" label="Little Leagues">Little Leagues</option>
        <option value="1500" selected label="Great League">Great League</option>
    		<option value="2500" label="Ultra League">Ultra League</option>
    		<option value="false" label="Master League">Master League</option>
    	</select></label>
    	<input id="pokeInput" list="pokeListDL" onfocus="this.value='';document.querySelector('datalist').id = '';" placeholder="Pok&eacute;mon" onkeyup="setMon(event)" oninput="setMon(event)" autocomplete="off"/>
    	<datalist id="pokeListDL"></datalist><span style="overflow-x:auto;" id="instructionsBox"><i><br />Please enter a valid Pok&eacute;mon to continue...</i></span>
      	
      <br />
      <table id="inputTable">
        <tr><td><img src="https://www.pvpivs.com/includes/icon-shadow-purple.png" alt="Shadow" width="17" height="17"></td><td title="Your Attack IV">Atk</td><td title="Your Defense IV">Def</td><td title="Your Stamina IV">Sta</td><td id="plusCell"><button class="circle plus" onclick="doTheInsert()"></button></td></tr>
        <tr>
          <td><input class='shadowCB' id="shdw[0]" type="checkbox" oninput="shdwUpdater()"></td>
          <td><select title="Your Attack IV" class="aIV" id="aIV[0]" onchange="main()">
            <option value="">&nbsp;</option>
            <option value="15">15</option>
            <option value="14">14</option>
            <option value="13">13</option>
            <option value="12">12</option>
            <option value="11">11</option>
            <option value="10">10</option>
            <option value="9">9</option>
            <option value="8">8</option>
            <option value="7">7</option>
            <option value="6">6</option>
            <option value="5">5</option>
            <option value="4">4</option>
            <option value="3">3</option>
            <option value="2">2</option>
            <option value="1">1</option>
            <option value="0">0</option>
          </select></td>
          <td><select title="Your Defense IV" class="dIV" id="dIV[0]" onchange="main()">
            <option value="15">15</option>
            <option value="14">14</option>
            <option value="13">13</option>
            <option value="12">12</option>
            <option value="11">11</option>
            <option value="10">10</option>
            <option value="9">9</option>
            <option value="8">8</option>
            <option value="7">7</option>
            <option value="6">6</option>
            <option value="5">5</option>
            <option value="4">4</option>
            <option value="3">3</option>
            <option value="2">2</option>
            <option value="1">1</option>
            <option value="0">0</option>
          </select></td>
          <td><select title="Your Stamina IV" class="sIV" id="sIV[0]" onchange="main()">
            <option value="15">15</option>
            <option value="14">14</option>
            <option value="13">13</option>
            <option value="12">12</option>
            <option value="11">11</option>
            <option value="10">10</option>
            <option value="9">9</option>
            <option value="8">8</option>
            <option value="7">7</option>
            <option value="6">6</option>
            <option value="5">5</option>
            <option value="4">4</option>
            <option value="3">3</option>
            <option value="2">2</option>
            <option value="1">1</option>
            <option value="0">0</option>
          </select></td>
          <td id="minusCell"><button class="circle minus" id="minus[0]" onclick="doTheRemoval()"></button></td>
        </tr>
      </table>
      <textarea id="CustomGroupExport" hidden></textarea>
      
      <div style="overflow-x:auto;" id="megaNote"></div>
      <div id="feedbackBox"><br /></div>
      <div style="overflow-x:auto;" id="outputBox"></div>
    
      <!-- Footer Code Below -->
      <script src="https://pvpivs.com/includes/footer.js"></script>
      <script src="https://pvpivs.com/includes/calculate.js"></script>
      <script src="https://pvpivs.com/includes/pokeListAA.js"></script>
        
      <script>
      var poke;
      var lastLeague;
      var perfTiming = false; /* used for timing execution */
      var mnlMod = false; /*track if min Lvl was adjusted*/
      var mxlMod = false; /*track if max Lvl was adjusted*/
      var ivMod = false; /*track if IV floor was adjusted*/
      let aIV=[document.getElementById('aIV[0]').value];
      let dIV=[document.getElementById('dIV[0]').value];
      let sIV=[document.getElementById('sIV[0]').value];
      let shdw=[document.getElementById('shdw[0]').checked];
      let rIV=[];
      let lvl=[];
      let mA = 0, mD = 0, mHP = 0; /* min stat filter vars */
      let lastMon = "";
      let lastShadow = false;
      
      /* Ensure we've successfully loaded mon */
      if (Object.keys(pokeListAA).length < 1)
      {
        console.error("Failed to load pokeListAA!");
        document.getElementById('feedbackBox').innerHTML = "<p><i>ERROR: Failed to load pokeListAA, please try again.<br>If this issue persists, please <a href='https://discord.gg/UD4Temq'>contact us on Discord</i></p>";
      } else {
        /* Load mon data into datalist placeholder */
        var datalist = "";
        
        for (mon in pokeListAA) {
          datalist+= "<option value="+mon+">";
        }
        document.getElementById('pokeListDL').innerHTML = datalist;
      }
      
      function adjustFloors(dexNum, poke) {
        if (perfTiming) {var T0 = performance.now();}
        var minLvl = document.getElementById('minLvl');
        var floor = document.getElementById('floor');
        
        /*check if we need to adjust IV Floor or Min Level*/
        
        if (shadowLegend.includes(dexNum) && shdw.indexOf(true) > -1) {
          console.log("Detected Shadow Legendary:" +poke);
          /*set min IVs to 10 and min Level to 20*/
          if (minLvl.value/1 > 8) {
            minLvl.value = 8;
            mnlMod = true;
          }
          floor.value = 6;
          ivMod = true;
          if (perfTiming) {stopTiming(T0, "adjustFloors");}
          return;
        }
        
        if (boxRewrd.includes(dexNum)) {
          console.log("Detected box reward mon:" +poke);
          /*set min IVs to 1 and min Level to 15*/
          if (minLvl.value/1 < 15) {
            minLvl.value = 15;
            mnlMod = true;
          }
          floor.value = 1;
          ivMod = true;
          if (perfTiming) {stopTiming(T0, "adjustFloors");}
          return;
        }
        
        if (raidOnly.includes(dexNum)) {
          console.log("Detected Raid+Trade mon:" +poke);
          /*set min IVs to 1 and min Level to 20*/
          if (minLvl.value/1 < 20) {
            minLvl.value = 20;
            mnlMod = true;
          }
          floor.value = 1;
          ivMod = true;
          if (perfTiming) {stopTiming(T0, "adjustFloors");}
          return;
        }
        
        if (boxMyth.includes(dexNum)) {
          console.log("Detected Mythical mon:" +poke);
          /*set min IVs to 10 and min Level to 15*/
          if (minLvl.value/1 < 15) {
            minLvl.value = 15;
            mnlMod = true;
          }
          floor.value = 10;
          ivMod = true;
          if (perfTiming) {stopTiming(T0, "adjustFloors");}
          return;
        }
        
        if (raidMyth.includes(dexNum)) {
          console.log("Detected Raid no Trade mon:" +poke);
          /*set min IVs to 10 and min Level to 20*/
          if (minLvl.value/1 < 20) {
            minLvl.value = 20;
            mnlMod = true;
          }
          floor.value = 10;
          ivMod = true;
          if (perfTiming) {stopTiming(T0, "adjustFloors");}
          return;
        }
      }
      
      function stopTiming(startTime, functionName) {
        var endTime = performance.now();
        console.log(functionName+": Execution took "+(endTime-startTime).toFixed(1)+"ms");
        document.getElementById('timing_outputs').innerHTML += functionName+": Execution took "+(endTime-startTime).toFixed(1)+"ms<br>";
      }
      
      function shdwUpdater() {
        /* Ensure we have current shdw state all input rows */
        for (var i=0; i<shdw.length; i++)
        {
          shdw[i] = document.getElementById("shdw["+i+"]").checked;
        }
        setMon();
      }
      
      function setMon(e) {
        if (perfTiming) {var T0 = performance.now();}
        
        document.getElementById('timing_outputs').innerHTML = "";
        
        if (document.getElementById('pokeInput').value.length < 3) {
          document.querySelector("datalist").id = "";
          if (perfTiming) {stopTiming(T0, "setMon");}
          return false;
        } else if (document.querySelector("datalist").id == "") {
          /* Prevent dropdown from covering Android keyboards */
          document.querySelector("datalist").id = "pokeListDL";
        }

        /* Exit if user is still adding/deleting the mon name */
        if (!(pokeListAA[document.getElementById('pokeInput').value]) && e.key && e.key != "Enter" && e.key.match(/[a-z]/i)) {
          console.log("setMon: "+document.getElementById('pokeInput').value.length+" chars, input: "+document.getElementById('pokeInput').value);
          /*console.log("User is still typing, exiting...");*/
          
          if (perfTiming) {stopTiming(T0, "setMon");}
          return false;
        }
        
        poke = document.getElementById('pokeInput').value;
        if (pokeListAA[poke]) {
          if (poke.indexOf("_SPECULATIVE") > -1)  {document.getElementById('megaNote').innerHTML = "<p><i>Please note these base stats are speculative and subject to change!</i></p>";}
          if (poke.indexOf("_PLACEHOLDER") > -1)  {document.getElementById('megaNote').innerHTML = "<p><i>Please note these base stats are unknown and not yet in the Game Master!</i></p>";}
          
          console.log("setMon: User has selected a valid poke: "+poke);
          
          if (lastMon == "") {
            /*console.log("setMon: Checking if we need to adjustFloors on first run");*/
            adjustFloors(pokeListAA[poke].split(',')[0].split("b")[0].split("&")[0]/1, poke);
          } else {
            /*console.log("setMon: Checking if shadow status changed: lastShadow:"+lastShadow+", shdw.indexOf(true):"+shdw.indexOf(true));*/
            if (shdw.indexOf(true) > -1 || lastShadow) {
              /*console.log("setMon: User just toggled a shadow box");*/
              adjustFloors(pokeListAA[poke].split(',')[0].split("b")[0].split("&")[0]/1, poke);
            }
          }
          
          if (lastMon != poke) {
            /*console.log("We've swapped mon, resetting monState: lastMon:"+lastMon+", poke:"+poke);*/
            resetMonState();
            adjustFloors(pokeListAA[poke].split(',')[0].split("b")[0].split("&")[0]/1, poke);
            if (perfTiming) {stopTiming(T0, "setMon");}
            main();
          } else {
            if (perfTiming) {stopTiming(T0, "setMon");}
            main();
          }
          /* Ensure we track the correct lastMon for next run */
          lastMon = poke;
          lastShadow = (shdw.indexOf(true) > -1) ? true : false;
        } else {/*exit if there's no valid mon yet*/
          console.error("setMon: User has not yet selected a valid poke:"+poke);
          if (perfTiming) {stopTiming(T0, "setMon");}
          /* TODO: Add partial text match style highlighting like Awesomplete had */
        }
      }
      
      function resetMonState() {
        if (perfTiming) {var T0 = performance.now();}
        
        var minLvl = document.getElementById('minLvl');
        var maxLvl = document.getElementById('maxLvl');
        var floor = document.getElementById('floor');
        
        /* Clear all existing IV Input Rows */
        for (var i=0; i<aIV.length; i++) {
          /* magic to actually remove all the rows one by one */
          var tr = document.getElementById('aIV['+i+']').parentNode;
          tr.parentNode.parentNode.removeChild(tr.parentNode);
        }
        
        /* clear the value arrays */
        aIV.splice(0, aIV.length);
        dIV.splice(0, dIV.length);
        sIV.splice(0, sIV.length);
        shdw.splice(0, shdw.length);
        
        /* Re-Add default IV Input Row */
        doTheInsert();
        
        /* clear min stat filters and lastLeague */
        mA = 0; mD = 0; mHP = 0; lastLeague = undefined;
        
        /*reset Min Level if we adjusted it previously*/
        if (mnlMod) {
          if ((minLvl.value == 8) || (minLvl.value == 15) || (minLvl.value == 20)) {
            minLvl.value = 1;
          }
          mnlMod = false;
        }
        /*reset Max Level if we adjusted it previously*/
        if (mxlMod) {
          if ((maxLvl.value == 15) || (maxLvl.value == 20)) {
            maxLvl.value = 40;
          }
          mxlMod = false;
        }
        /*reset IV Floor if we adjusted it previously*/
        if (ivMod) {
          if ((floor.value == 1) || (floor.value == 6) || (floor.value == 10)) {
            floor.value = 0;
          }
          ivMod = false;
        }
        if (perfTiming) {stopTiming(T0, "resetMonState");}
      }
      
      function toggleFamilyEvos() {
        if (perfTiming) {var T0 = performance.now();}
        
        /* Toggle Family Evo League Selection */
        if (document.getElementById("family").checked) {
          document.getElementById("familyEvoLeagueLbl").style.display = "inline-block";
        } else {
          document.getElementById("familyEvoLeagueLbl").style.display = "none";
        }
        
        if (perfTiming) {stopTiming(T0, "toggleFamilyEvos");}
        setUserPreference('family');
      }
      
      function outputUserRanks(aIV, dIV, sIV, shdw, league, leagueName, ranks, settings, dec, URL) {
        if (perfTiming) {var T0 = performance.now();}
        
        settings = settings.split(''); /* split into characters */
        var evoLeague = document.getElementById('familyEvoLeague').value;
        var evoLeagueName = document.getElementById('familyEvoLeague').options[document.getElementById('familyEvoLeague').selectedIndex].innerHTML;
        var minLvl = document.getElementById('minLvl').value;
        var maxLvl = document.getElementById('maxLvl').value;
        var floor = document.getElementById('floor').value;
        var limit = document.getElementById('limit').value;
        var keys = Object.keys(ranks);
        var maxStatProd = keys[0].split(".")[0];
        var evos = pokeListAA[poke].split(',').slice(4, pokeListAA[poke].split(',').length);
        var evoLen = evos.length;
        
        /* properly parse settings bits as true/false */
        for (var i=0; i<settings.length; i++) { settings[i] = (settings[i] == 1) ? true : false;}
        
        /*we have at least one rank to output, let's print! */
        var evoHtml = "";
        var evoFeedback = "";
        var html = "<table id='outTable'><tr><th>#</th><th>Lvl</th><th>CP</th>";
        
        if (settings[0]) {
          html += "<th>L"+minLvl+" CP</th>"
        }
          
        html += "<th>Atk IV</th><th>Def</th><th>Stam</th><th>Perfect</th>";
        
        /*include XL candy costs if Max Level > 41*/
        if (maxLvl > 41 && ranks.maxLvl>41) {
          html+="<th>XL</th>";
        }
        /*include stardust costs if enabled*/
        if (settings[5]) {
          html+="<th>Dust</th>";
        }
        
        /*include cmp columns if checked*/
        if (settings[1] == true) {
          if (ranks.numRanks/1 < 100) {
            /*if there isn't a top 100, make it Top numRanks*/
            html+="<th>R1 CMP</th><th>T"+ranks.numRanks+" CMP</th>";
          } else {
            html+="<th>R1 CMP</th><th>T100 CMP</th>";
          }
          ranks = cmpCalcs(ranks, keys, dec);
        }
        if (perfTiming) {var Tc = performance.now();}
        
        html+="<th>PvP Atk</th><th>Def</th><th>HP</th><th>Stat Prod</th></tr>";
        
        /*print main table output and count actual outputted rows/ranks*/
        var actualRank = 1; var rowsOutput = 0;
        var minAtk = ranks.minAtk.value, maxAtk = ranks.maxAtk.value;
        var minDef = ranks.minDef.value, maxDef = ranks.maxDef.value;
        var filtered = false;
        
        /* Initialize min stat filters if blank (first run only)*/
        if ((mA+mD+mHP)/1 == 0) { /*console.log("Noticed mA,mD,or mHP are 0, initializing...");*/
          mA = numOut(minAtk,dec);mD = numOut(minDef,dec);mHP = ranks.minHP.value;
        } else {
          /* Ensure that we don't have atk/def/HP filters above maximums */
          mA = (mA/1 > maxAtk/1) ? numOut(maxAtk,dec)-1 : mA;
          mD = (mD/1 > maxDef/1) ? numOut(maxDef,dec)-1 : mD;
          mHP = (mHP/1 > ranks.maxHP.value/1) ? ranks.maxHP.value/1-1 : mHP;
        }

        /*used to ensure we don't Display Trade Improvement % for ineligible IVs*/
        var gmRhtml = null;
        document.getElementById('feedbackBox').innerHTML = "";
        var uri;
        lvl = []
        ;rIV = [];
        var validIVs = "";
        var invalidIVs = "";
        
        /* Check to see if the user has filtered their stat output*/
        if (ranks.minAtk.value != mA && ranks.minDef.value != mD && ranks.minHP.value != mHP) {
          filtered = true;
        }
        
        /* Generate user inputted IV rows for main output table */
        for (i=0; i<aIV.length; i++) {
          if (aIV[i] && dIV[i] && sIV[i]) {
            if ((aIV[i]/1 >= floor/1) && (dIV[i]/1 >= floor/1) && (sIV[i]/1 >= floor/1)) {
              /*console.log("i:"+i+" All 3 IVs > floor("+floor+"): "+aIV[i]+", "+dIV[i]+", "+sIV[i]+", aIV.length:"+aIV.length);*/
              [gmRhtml, validIV] = getMonRank(ranks, keys, shdw[i], settings[1], maxStatProd, aIV[i], dIV[i], sIV[i], mA, mD, mHP, filtered, aIV.length, false, false, maxLvl, settings[5], dec, settings[0]);
              
              /* Keep track of which user IVs are valid and invalid per stat filters */
              if (filtered) {
                if (validIV) {
                  validIVs += aIV[i]+"-"+dIV[i]+"-"+sIV[i]+" ";
                } else {
                  invalidIVs += aIV[i]+"-"+dIV[i]+"-"+sIV[i]+" ";
                }
              }
              
              if (aIV[i] && dIV[i] && sIV[i] && (gmRhtml == "")) {
                console.log("i:"+i+" Detected too high CP after getMonRank");
                document.getElementById('feedbackBox').innerHTML += "<p><i>Row "+(i+1)+" with IVs ("+aIV[i]+"/"+dIV[i]+"/"+sIV[i]+") & min level ("+minLvl+") is too big for "+leagueName+"<br>Please check Settings: Min Level and try again</i></p><br>";
              } else {html += gmRhtml;}
              
              /* See if we need to output evo familyTable*/
              if (evoLen && settings[3]) {
                /* valid set of IVs, need to find base stats for evos */
                for (var e=0; e<evoLen; e++) {
                  /* Ensure we don't show impossible Tyrogue evos (highest stat determines evo) */
                  if (poke == "Tyrogue" && validTyroEvo(aIV[i], dIV[i], sIV[i], evos[e])) {continue;}
                  
                  var evoVals = pokeListAA[evos[e]].split(",");
                  var evoRanks = calculate(parseInt(evoVals[1]), parseInt(evoVals[2]), parseInt(evoVals[3]), floor, minLvl, maxLvl, false, evoLeague, evos[e]);
                  var evoKeys = Object.keys(evoRanks);
                  var evoMaxStatProd = evoKeys[0].split(".")[0];
                  /*create link for evo table entry*/
                  uri = URL + "?mon="+evos[e]+"&r="+limit+"&cp="+league+"&f="+floor+"&min="+minLvl+"&max="+maxLvl+"&set="+settings+"&fel="+evoLeague+"&IVs="+aIV[i] + "_" + dIV[i] + "_" + sIV[i] + "_" + shdw[i]+"&mA=0&mD=0&mHP=0";

                  var evoGMRhtml = getMonRank(evoRanks, evoKeys, shdw[i], settings[1], evoMaxStatProd, aIV[i], dIV[i], sIV[i], 0, 0, 0, false, aIV.length, evos[e], uri, false, settings[5], dec, false);
                  if (evoGMRhtml) {
                    if (evoHtml) {
                      /*if this is a second evo, just add it*/
                      evoHtml += evoGMRhtml;
                    } else {
                      /*include stardust costs if enabled*/
                      var dustHeader = "";
                      if (settings[5]) {
                        dustHeader="<th>Dust</th>";
                      }
                      /*if this is the first evo, add header too*/
                      if ((evoLen > 1) || (aIV.length > 1)) {
                        evoHtml = "<p><i>"+evoLen+" "+poke+" "+evoLeagueName+" family evos:<br>(click table headers to sort)</i></p><table id='familyTable'><tr><th>Pokémon</th>";
                        if (aIV.length > 1) {
                          evoHtml += "<th>IVs</th>";
                        }
                        evoHtml += "<th>#</th><th>Lvl</th><th>CP</th><th>Perfect</th>"+dustHeader+"<th>Atk</th><th>Def</th><th>HP</th><th>Stat Prod</th></tr>";
                      } else {
                        evoHtml = "<p><i>"+evoLen+" "+poke+" "+evoLeagueName+" family evo:</i></p><table id='familyTable'><tr><th>Pokémon</th><th>#</th><th>Lvl</th><th>CP</th><th>Perfect</th>"+dustHeader+"<th>Atk</th><th>Def</th><th>HP</th><th>Stat Prod</th></tr>";
                      }
                      evoHtml += evoGMRhtml;
                    }
                  } else {
                    evoFeedback += "<p><i>"+evos[e]+" with your IVs ("+aIV[i]+"/"+dIV[i]+"/"+sIV[i]+") & min level ("+minLvl+") is too big for "+leagueName+"</i></p>";
                  }
                }
              }
            } else {
              console.log("i:"+i+" Detected IV below Floor:"+floor+" aIV[i]:"+aIV[i]+" dIV[i]:"+dIV[i]+" sIV[i]:"+sIV[i]);
              document.getElementById('feedbackBox').innerHTML += "<p><i>Row "+(i+1)+" with IVs ("+aIV[i]+"/"+dIV[i]+"/"+sIV[i]+") is below the IV Floor ("+floor+")<br>Please check Settings: IV Floor and try again</i></p><br>";
            }
          } else {
            console.log("i:"+i+" Missing an IV, detected: aIV["+i+"]:"+aIV[i]+" dIV["+i+"]:"+dIV[i]+" sIV["+i+"]:"+sIV[i]);
            document.getElementById('feedbackBox').innerHTML += "<p><i>Please enter an Attack IV for Row "+(i+1)+" with IVs (_"+aIV[i]+"_/"+dIV[i]+"/"+sIV[i]+") to check your "+poke+"'s "+leagueName+" PvP Rank</i></p>";
            lvl.push(false); /* keep this balanced */
          }
        }
        if (filtered) {
          if (validIVs && invalidIVs) {document.getElementById('feedbackBox').innerHTML += "<p><i>Based on your filters, Valid IVs: "+validIVs+"</i></p><p><i>Invalid IVs: "+invalidIVs+"</i></p>";
          } else if (validIVs) {
            document.getElementById('feedbackBox').innerHTML += "<p><i>All of your IVs are above your minimum stat filters!</i></p>";
          } else {
            document.getElementById('feedbackBox').innerHTML += "<p><i>None of your IVs are above your minimum stat filters!</i></p>";
          }
        }
        evoHtml += "</table>";
        evoFeedback += "<br />";
        /*console.log("outputUserRanks: Finished creating output for IVs, now printing main table...");*/
        if (perfTiming) {var Ti = performance.now();}
        
        /* used to track if we should hide XL candy column */
        var nonZeroXL = false;
        var outIVs = "";
        var filtered = false;
        
        for (i=0; ((actualRank/1<=ranks.numRanks/1) && (actualRank/1 <= limit/1)); i++) {
          for (var j=0; j<ranks[keys[i]].length; j++) {
            
            if ((mA/1 <= numOut(ranks[keys[i]][j].battle.A,dec)) && (mD/1 <= numOut(ranks[keys[i]][j].battle.D,dec)) && (mHP/1 <= ranks[keys[i]][j].battle.S)) {
              /* All three stats are above filter cutoffs, proceed with printing this row */
              if (actualRank/1 <= limit/1) {
                html+="<tr><td>"+actualRank+"</td>"; /*Rank*/
                html+="<td>"+ranks[keys[i]][j].L+"</td>"; /*Level*/
                html+="<td>"+ranks[keys[i]][j].CP+"</td>"; /*Final CP*/
                if (settings[0]) {html+="<td>"+Math.max(10, Math.floor((pokeListAA[poke].split(',')[1]/1 + ranks[keys[i]][j].IVs.A) * Math.sqrt(pokeListAA[poke].split(',')[2]/1 + ranks[keys[i]][j].IVs.D) * Math.sqrt(pokeListAA[poke].split(',')[3]/1 + ranks[keys[i]][j].IVs.S) * cpm[(minLvl-1)*2] * cpm[(minLvl-1)*2] / 10))+"</td>"; /*Raid/Hatch CP*/}
                html+="<td>"+ranks[keys[i]][j].IVs.A+"</td>"; /*Atk IV*/
                html+="<td>"+ranks[keys[i]][j].IVs.D+"</td>"; /*Def IV*/
                html+="<td>"+ranks[keys[i]][j].IVs.S+"</td>"; /*Sta IV*/
                outIVs+=ranks[keys[i]][j].IVs.A+"-"+ranks[keys[i]][j].IVs.D+"-"+ranks[keys[i]][j].IVs.S+",";
                html+="<td>"+parseFloat((100*keys[i].split(".")[0])/maxStatProd).toFixed(3)+"%"+"</td>"; /*Perfection*/
                if (maxLvl > 41 && ranks.maxLvl>41) {
                  var candy = XLcandy(ranks[keys[i]][j].L/1 - 40);
                  html+="<td>"+candy+"</td>";
                  if (!nonZeroXL && candy > 0) {nonZeroXL = true;}
                }
                if (settings[5]) {html+= "<td>"+stardust(minLvl/1, ranks[keys[i]][j].L/1, 0, false)+"</td>";}
                if (settings[1]) {
                  html+="<td>"+ranks[keys[i]][j].IVs.R1+"</td>"; /*R1 CMP*/
                  if (ranks.numRanks/1 < 100) { /*account for when there aren't 100 numRanks*/
                    html+="<td>"+Math.round(((ranks[keys[i]][j].IVs.T100)/ranks.numRanks)*100)+"%"+"</td>"; /*T100 CMP*/
                  } else {
                    html+="<td>"+ranks[keys[i]][j].IVs.T100+"%"+"</td>"; /*T100 CMP*/
                  }
                }
                html+="<td>"+numOut(ranks[keys[i]][j].battle.A,dec)+"</td>"; /*GL Atk Total*/
                html+="<td>"+numOut(ranks[keys[i]][j].battle.D,dec)+"</td>"; /*GL Def Total*/
                html+="<td>"+ranks[keys[i]][j].battle.S+"</td>"; /*GL HP*/
                html+="<td>"+keys[i].split(".")[0]+"</td>"; /*Stat Product*/
                html+="</tr>";
                rowsOutput = rowsOutput/1 + 1;
              }
            } else {
              /* Skip printing row, but ensure we still print a total of <limit> rows */
              limit = (limit/1 + 1)/1;
              if (!filtered)
              {
                filtered = true;
              }
            }
            actualRank = actualRank + 1;
          }
        }
        /*console.log("outputUserRanks: Finished loop with i:"+i+", actualRank:"+actualRank+" >= limit:"+limit);*/
        html+="</table>"; /*finish building the whole table*/
        var printLimit = Math.min(rowsOutput, limit, ranks.numRanks); /* TODO: Delete this? */
        if (perfTiming) {var Tr = performance.now();}
        
        /*prepare max stat html output*/
        var maxAtkurl = encodeURI(URL + "?mon="+poke+"&r="+limit+"&cp="+league+"&f="+floor+"&min="+minLvl+"&max="+maxLvl+"&set="+settings+"&fel="+evoLeague+"&IVs="+ranks.maxAtk.aIV + "_" + ranks.maxAtk.dIV + "_" + ranks.maxAtk.sIV);
        var maxDefurl = encodeURI(URL + "?mon="+poke+"&r="+limit+"&cp="+league+"&f="+floor+"&min="+minLvl+"&max="+maxLvl+"&set="+settings+"&fel="+evoLeague+"&IVs="+ranks.maxDef.aIV + "_" + ranks.maxDef.dIV + "_" + ranks.maxDef.sIV);
        var maxHPurl = encodeURI(URL + "?mon="+poke+"&r="+limit+"&cp="+league+"&f="+floor+"&min="+minLvl+"&max="+maxLvl+"&set="+settings+"&fel="+evoLeague+"&IVs="+ranks.maxHP.aIV + "_" + ranks.maxHP.dIV + "_" + ranks.maxHP.sIV);
        var minAtkurl = encodeURI(URL + "?mon="+poke+"&r="+limit+"&cp="+league+"&f="+floor+"&min="+minLvl+"&max="+maxLvl+"&set="+settings+"&fel="+evoLeague+"&IVs="+ranks.minAtk.aIV + "_" + ranks.minAtk.dIV + "_" + ranks.minAtk.sIV);
        var minDefurl = encodeURI(URL + "?mon="+poke+"&r="+limit+"&cp="+league+"&f="+floor+"&min="+minLvl+"&max="+maxLvl+"&set="+settings+"&fel="+evoLeague+"&IVs="+ranks.minDef.aIV + "_" + ranks.minDef.dIV + "_" + ranks.minDef.sIV);
        var minHPurl = encodeURI(URL + "?mon="+poke+"&r="+limit+"&cp="+league+"&f="+floor+"&min="+minLvl+"&max="+maxLvl+"&set="+settings+"&fel="+evoLeague+"&IVs="+ranks.minHP.aIV + "_" + ranks.minHP.dIV + "_" + ranks.minHP.sIV);
        
        var step = 1/Math.pow(10,dec);

        var ranges = "<br />Atk &ge; <input type='number' step="+step+" id='atkVal' min="+numOut(minAtk,dec)+" max="+numOut(maxAtk,dec)+" value="+mA+" onchange='atkRange.value=this.value;mA=this.value;main();'> <a href="+minAtkurl+">"+numOut(minAtk,dec)+"</a><input type='range' id='atkRange' min="+numOut(minAtk,dec)+" max="+numOut(maxAtk,dec)+" value="+mA+" onchange='atkVal.value=this.value;mA=this.value;main();'><a href="+maxAtkurl+">"+numOut(maxAtk,dec)+"</a><br>";
        ranges += "Def &ge; <input type='number' step="+step+" id='defVal' min="+numOut(minDef,dec)+" max="+numOut(maxDef,dec)+" value="+mD+" onchange='defRange.value=this.value;mD=this.value;main();'> <a href="+minDefurl+">"+numOut(minDef,dec)+"</a><input type='range' id='defRange' min="+numOut(minDef,dec)+" max="+numOut(maxDef,dec)+" value="+mD+" onchange='defVal.value=this.value;mD=this.value;main();'><a href="+maxDefurl+">"+numOut(maxDef,dec)+"</a><br>";
        ranges += "HP &ge; <input type='number' step='1' min="+ranks.minHP.value+" max="+ranks.maxHP.value+" id='hpVal' value="+mHP+" onchange='hpRange.value=this.value;mHP=this.value;main();'> <a href="+minHPurl+">"+ranks.minHP.value+"</a><input type='range' id='hpRange' min="+ranks.minHP.value+" max="+ranks.maxHP.value+" value="+mHP+" onchange='hpVal.value=this.value;mHP=this.value;main();'><a href="+maxHPurl+">"+ranks.maxHP.value+"</a><br />";
        
        /*compute trade percentages*/
        var trades = "";
        var searchLink = "";
        var statProd = html.split('</td></tr><tr><td>')[0];
        if ((gmRhtml != "") && (statProd != null) && (aIV[aIV.length-1] && dIV[aIV.length-1] && sIV[aIV.length-1])) {
          statProd = statProd.split('</td><td>');
          statProd = statProd[statProd.length-1];
          if (settings[4])  {
            trades = tradePcnts(ranks, keys, statProd, floor, aIV.length, aIV[aIV.length-1], dIV[aIV.length-1], sIV[aIV.length-1]);
          }
          /*TODO: FIX THIS Generate Search String links for each IV set*/
          /*https://pvpivs.com/searchStr.html?mon=Dusknoir&cp=1500&r=f_10_f_f&o=1001100&l=en*/
          if (!filtered) {
            for (i=0; i<rIV.length; i++) {
              /*searchLink += "<p><a href='https://pvpivs.com/searchStr.html?mon="+poke+"&cp="+league+"set=00011001&m="+maxLvl+"'>Generate "+poke+" Search String to Trash below Rank "+rIV[i]+"</a></p>";*/
            }
          }
        }
        
        /* Print out link to custom IV Search String if any ranks were filtered out*/
        if (filtered) {
          /* Trim trailing comma off string */
          outIVs = outIVs.replace(/,\s*$/, "");
          searchLink += "<p><a href='https://www.pvpivs.com/searchStr.html?mon="+poke+"&cp="+league+"&o=00011001&IVentry="+outIVs+"'>Generate "+poke+" Search String for only these filtered IVs</a></p>";
        }
        
        document.getElementById('outputBox').innerHTML = evoHtml + evoFeedback + html + ranges + searchLink + "<br>" + trades;
        
        /* Include how many total ranks were generated at the end of instructionsBox */
        document.getElementById("instructionsBox").innerHTML += "<p id='totalRanks'> of "+ranks.numRanks+":</p><br />";
        
        if (perfTiming) {var T1 = performance.now();
        console.log(poke+" outputUserRanks: "+(T1-T0).toFixed(1)+"ms (CMP "+(Tc-T0).toFixed(1)+"ms +IVs "+(Ti-Tc).toFixed(1)+"ms + Rows "+(Tr-Ti).toFixed(1)+"ms) for "+ranks.numRanks+" ranks.");
        document.getElementById('timing_outputs').innerHTML += "outputUserRanks: "+(T1-T0).toFixed(1)+"ms (CMP "+(Tc-T0).toFixed(1)+"ms +IVs "+(Ti-Tc).toFixed(1)+"ms + Rows "+(Tr-Ti).toFixed(1)+"ms) for "+ranks.numRanks+" ranks.<br>";
        }
        return [printLimit];
      }
      
      function main() {
        if (perfTiming) {var T0 = performance.now();}
        
        else {document.getElementById('timing_outputs').innerHTML = "";}
        
        /* Ensure we have a mon before continuing */
        if(!poke) {
          /*exit if there's no mon yet*/
          console.log("main: User has not yet selected a poke:"+poke);
          if (perfTiming) {stopTiming(T0, "main");}
          return true;
        } else { /* Have a valid poke, remove instructions */
          document.getElementById('instructionsBox').innerHTML = "";
        }
        
        /*ensure we clear the prior output between runs*/
        document.getElementById('outputBox').innerHTML = "";
        if (document.contains(document.getElementById("totalRanks"))) {document.getElementById("totalRanks").remove();}
        
        var monInfo = pokeListAA[poke].split(',');
        /*Ensure we get the info we need to continue*/
        if (monInfo == "")
        {
          console.error("Cannot find monInfo, returning");
          document.getElementById('instructionsBox').innerHTML = "<p><i>ERROR: Cannot find monInfo, please try again.<br>If this issue persists, please <a href='https://discord.gg/UD4Temq'>contact us on Discord</i></p>";
          if (perfTiming) {stopTiming(T0, "main");}
          return false;
        }
        
        /* name user input fields for code readability */
        var league = document.getElementById('league').value;
        var dec = document.getElementById('dec').value;
        var leagueName = document.getElementById('league').options[document.getElementById('league').selectedIndex].innerHTML;
        if ((lastLeague) && (leagueName !== lastLeague)){ /* Reset if new League */mA = 0; mD = 0; mHP = 0;}
        lastLeague = leagueName; /* Store League for next run */
        var ranks = calculate(parseInt(monInfo[1]), parseInt(monInfo[2]), parseInt(monInfo[3]), document.getElementById('floor').value, document.getElementById('minLvl').value, document.getElementById('maxLvl').value, document.getElementById("dti").checked, league, poke);
        var settings = (document.getElementById('mlCP').checked ? "1":"0") + (document.getElementById("cmp").checked ? "1":"0") + (document.getElementById("cge").checked ? "1":"0") + (document.getElementById("family").checked ? "1":"0") + (document.getElementById("dti").checked ? "1":"0") + (document.getElementById("dust").checked ? "1":"0");
        var URL = window.location.href.split("?")[0];
        
        /*ensure we actually generated something to output*/
        if (ranks.numRanks/1 < 1) {
          /*nothing to output, print Error and exit*/
          document.getElementById('instructionsBox').innerHTML = "<p><i>No eligible "+leagueName+" IVs found!<br>Please check the Min Level in Settings and try again</i></p><br />";
          document.getElementById('feedbackBox').innerHTML = "";
          console.log("No ranks generated!");
          if (perfTiming) {stopTiming(T0, "main");}
          return false;
        }
        
        /* Ensure we have current IVs for all input rows */
        for (var i=0; i<aIV.length; i++)
        {
          aIV[i] = document.getElementById("aIV["+i+"]").value;
          dIV[i] = document.getElementById("dIV["+i+"]").value;
          sIV[i] = document.getElementById("sIV["+i+"]").value;
        }
        
        const [printLimit] = outputUserRanks(aIV, dIV, sIV, shdw, league, leagueName, ranks, settings, dec, URL);
        
        displayPvPokeEvoGroup();
        
        /*update the URL with search parameters*/
        /*URL = "mon=Venusaur&r=10&cp=1500&f=0&min=1&max=40&set=000000&fel=1500&mA=119.7&mD=112.6&mHP=113";*/
        var uri = URL + "?mon="+poke+"&r="+printLimit+"&cp="+league;
        /* Only print remaining params if they aren't default values */
        if (document.getElementById('floor').value>0) {uri += "&f="+document.getElementById('floor').value;}
        if (document.getElementById('minLvl').value>1) {uri += "&min="+document.getElementById('minLvl').value;}
        if (document.getElementById('maxLvl').value!=40) {uri += "&max="+document.getElementById('maxLvl').value;}
        if (settings!=000000) {uri += "&set="+settings;}
        if (document.getElementById('familyEvoLeague').value!=1500) {uri += "&fel="+document.getElementById('familyEvoLeague').value;}
        if (mA != numOut(ranks.minAtk.value, dec)) {uri += "&mA="+mA;console.log("mA:"+mA+" while numOut("+ranks.minAtk.value+", "+dec+"):"+numOut(ranks.minAtk.value, dec))}
        if (mD != numOut(ranks.minDef.value, dec)) {uri += "&mD="+mD;}
        if (mHP != ranks.minHP.value) {uri += "&mHP="+mHP;}
        if (document.getElementById('dec').value>1) {uri += "&dec="+document.getElementById('dec').value;}
        if (aIV[0] && dIV[0] && sIV[0]) {
          var IVs = "";
          for (i=0; i<aIV.length; i++) {
            if (i > 0) {IVs += "-";} else {IVs = "";}
            IVs += aIV[i] + "_" + dIV[i] + "_" + sIV[i] + "_" + shdw[i];
          }
          uri += "&IVs="+IVs;
        }
        uri = encodeURI(uri);
        
        /* Update title and description to improve SEO for chosen mon */
        var newTitle = poke+" PvP IVs - "+leagueName+" Rankings (Top "+document.getElementById('limit').value+")";
        document.title = newTitle.replace(/_/g, ' '); /* replace all underscores ('_') with spaces */
        window.history.pushState(null, newTitle, uri);
        var newDescrp = poke+" PvP IVs lookup tool for Pokémon Go™ to help compare your "+poke+"'s PvP IVs to ideal PvP IVs. Finds PvP IVs for any wild-caught, weather boosted, traded, raided, hatched, and even purified "+poke+"! Did you catch the very best?";
        document.querySelector('meta[name="description"]').setAttribute("content", newDescrp);
        /* Update canonical link to include mon & league for improved SEO */
        document.querySelector("link[rel='canonical']").setAttribute("href", "https://pvpivs.com/?mon="+poke+"&cp="+league);

        /* Add event listener to capture user clicking on any table row */
        document.getElementById('outTable').addEventListener('click', (function(){addToCompare(event)}), false);
        
        /*make table sortable by clicking on any header https://stackoverflow.com/a/49041392 */
        const getCellValue = (tr, idx) => tr.children[idx].innerText || tr.children[idx].textContent;
        const comparer = (idx, asc) => (a, b) => ((v1, v2) =>
            v1 !== '' && v2 !== '' && !isNaN(v1.replace("%", "")) && !isNaN(v2.replace("%", "")) ? v1.replace("%", "") - v2.replace("%", "") : v1.toString().localeCompare(v2)
            )(getCellValue(asc ? a : b, idx), getCellValue(asc ? b : a, idx));
        
        /*do the work...*/
        document.querySelectorAll('th').forEach(th => th.addEventListener('click', (() => {
            const table = th.closest('table');
            Array.from(table.querySelectorAll('tr:nth-child(n+2)'))
                .sort(comparer(Array.from(th.parentNode.children).indexOf(th), this.asc = !this.asc))
                .forEach(tr => table.appendChild(tr) );
        })));
        
        if (perfTiming) {stopTiming(T0, "main");}
      }
      
      function displayPvPokeEvoGroup() {
        if (perfTiming) {var T0 = performance.now();}
        
        /*show textbox with PvPoke Custom Group Export data*/
        if (document.getElementById("cge").checked == true)
        {
          var name = poke;
          /* Game Master uses Alola, but PvPoke uses Alolan, need to fix for valid data export */
          if (name.includes("_Alola")) {
            name = name + "n";
          }
          var cgeData = "";
          var maxWidth = 0;
          for (var i=0; i<aIV.length; i++) {
            var mon = name;
            if (shdw[i]) {
              mon = name + "_shadow";
            }
            if (aIV[i] == "") {
              console.log("skipping incomplete row, i:"+i+", aIV:"+aIV[i]+", dIV:"+dIV[i]+", sIV:"+sIV[i]);
              continue;
            }
            var row = mon+",,,,"+lvl[i]+","+aIV[i]+","+dIV[i]+","+sIV[i];
            if (row.length > maxWidth) {
              maxWidth = row.length;
            }
            if (cgeData!="") {
              var newline = String.fromCharCode(13, 10); /*https://stackoverflow.com/a/28106346*/
              cgeData += newline+mon+",,,,"+lvl[i]+","+aIV[i]+","+dIV[i]+","+sIV[i];
            }
            else {
              cgeData = row;
            }
          }
          document.getElementById("CustomGroupExport").style.display = "inline-block";
          document.getElementById("CustomGroupExport").cols = maxWidth;
          document.getElementById("CustomGroupExport").rows = sIV.length;
          document.getElementById("CustomGroupExport").value = cgeData;
        } else if (document.getElementById("CustomGroupExport").style.display == "inline-block") { /*hide textbox if user has unchecked the option*/
          document.getElementById("CustomGroupExport").style.display = "none";
        }
        if (perfTiming) {stopTiming(T0, "displayPvPokeEvoGroup");}
      }
      
      function addToCompare(e) {
        if (perfTiming) {var T0 = performance.now();}
        var row = window.event.target.parentNode;
        /* Ensure we didn't click on the header row to sort and ensure we aren't adding duplicate IVs */
        
        var offset = 3; /* Account for mlCP column */
        if (document.getElementById('mlCP').checked) {offset+=1;}
        if (row.rowIndex/1 > aIV.length/1) {
          
          /* Get the IVs we're trying to add */
          var atk = row.cells[offset].innerHTML;
          var def = row.cells[offset+1].innerHTML;
          var sta = row.cells[offset+2].innerHTML;
          var uniqueIVs = true;
          
          /* Ensure we aren't duplicating IVs */
          for (var i=0; i<aIV.length; i++) {
            if ((atk/1 == aIV[i]) && (def/1 == dIV[i]) && (sta == sIV[i])) {
              uniqueIVs = false;
              break;
            }
          }
          
          if (uniqueIVs) {
            doTheInsert(atk, def, sta);
            main();
          } else {
            console.log(atk+"/"+def+"/"+sta+" already exists in comparison IVs, not adding to compare");
            if (document.getElementById('feedbackBox').innerHTML.includes(atk+"/"+def+"/"+sta+" already exists in comparison IVs")) {
              /*console.log("This exact error message is already on screen, skipping duplicating error message");*/
            } else {
              /*console.log("Could not find error message, need to print to screen")*/
              document.getElementById('feedbackBox').innerHTML += "<br /><i>"+atk+"/"+def+"/"+sta+" already exists in comparison IVs</i>";
            }
          }
        } else {
          console.log("Skipping adding row as we clicked on the Header or Highlighted Row:"+row.rowIndex);
        }
        if (perfTiming) {stopTiming(T0, "addToCompare");}
      }
      
      function numOut(num, decimals) {
        if (isNaN(decimals/1)) {
          console.error("numOut: unsupported decimal place:"+JSON.stringify(decimals));
          return false;
        }
        
        var places = Math.pow(10,decimals);
        var out = (Math.trunc(num*places)/places).toFixed(decimals);
        return out;
      }
      
      function saveCurrentSettings() {
        if (perfTiming) {var T0 = performance.now();}
        setUserPreference("limit,league,floor,minLvl,maxLvl,cmp,cge,family,familyEvoLeague,dti,dust,dec");
        if (perfTiming) {stopTiming(T0, "saveCurrentSettings");}
        main();
      }
      
      function checkUserPreference(settings) {
        if (perfTiming) {var T0 = performance.now();}
        /* Ensure each setting is a full word, not characters */
        settings = settings.split(",");
        
        for (var i=0;  i<settings.length; i++) {
          if (localStorage[settings[i]] === undefined) {
            /* User has no preference for us to read yet */
            /*console.log("Could not find localStorage."+settings[i]);*/
            continue;
          }
          /* User has a stored preference for us to read */
          if (localStorage[settings[i]] === "true") {
            document.getElementById(settings[i]).checked = true;
          } else if (["familyEvoLeague","league"].includes(settings[i])) { /* https://stackoverflow.com/a/47340778 */
            document.getElementById(settings[i]).selectedIndex = [...document.getElementById(settings[i]).options].findIndex (option => option.text === localStorage[settings[i]]);
          } else if (["limit","floor","minLvl","maxLvl"].includes(settings[i])) {
            document.getElementById(settings[i]).value = localStorage[settings[i]];
          }
          console.log("Read user's preference for "+settings[i]+" as: "+localStorage[settings[i]]);
        }
        if (perfTiming) {stopTiming(T0, "checkUserPreference");}
      }
      
      function setUserPreference(settings) {
        if (perfTiming) {var T0 = performance.now();}
        /* Ensure each setting is a full word, not characters */
        if (document.getElementById("save").checked) {
          settings = settings.split(",");
          for (var i=0; i<settings.length; i++) {
            /*console.log("Attempting to save settings["+i+"]:"+settings[i]);*/
            if (["familyEvoLeague","league"].includes(settings[i])) {
              localStorage[settings[i]] = document.getElementById(settings[i]).options[document.getElementById(settings[i]).selectedIndex].innerHTML;
            } else if (["limit","floor","minLvl","maxLvl"].includes(settings[i])) {
              localStorage[settings[i]] = document.getElementById(settings[i]).value;
            } else {
              localStorage[settings[i]] = document.getElementById(settings[i]).checked ? "true" : "false";
            }
            console.log("Stored user's preference for "+settings[i]+" as "+localStorage[settings[i]]);
          }/*else{console.log("User does not want preferences saved");}*/
        }
        if (perfTiming) {stopTiming(T0, "setUserPreference");}
        main();
      }
      
      function updateSitemap() {
        if (perfTiming) {var T0 = performance.now();}
        /* TODO: Ensure output contains &amp; instead of & */
        var singleRankLinks = "";
        var leagueRankLinks = "";
        var searchStrLinks = "";
        var leagues = ["500","1500","2500","false"];
        var langs = ["en","fr","de","es","it","ja","ko","pt","zh"];
        var levels = ["51","50","49","48","47","46","45","44","43","42","41","40","39","38","37","36","35","34","33","32","31","30","29","28","27","26","25","24","23","22","21","20","19","18","17","16","15","14","13","12","11","10","9","8","7","6","5","4","3","2","1"];
        var first = true;
        
        for (mon in pokeListAA) {
          if ((mon.includes("_PLACEHOLDER")) || (mon.includes("_SPECULATIVE"))) {
            /*console.log("Skipping: "+mon);*/
            continue;
          }
          for (var j=0; j<leagues.length; j++) {
            singleRankLinks += '&lt;url&gt;&lt;loc&gt;https://pvpivs.com/?mon='+mon+'&amp;cp='+leagues[j]+'&lt;/loc&gt;&lt;changefreq&gt;always&lt;/changefreq&gt;&lt;priority&gt;0.9&lt;/priority&gt;&lt;/url&gt;<br />';
            /* Include max level info for League Rankings */
            for (var k=0; k<levels.length; k++) {
              if (first==true) {leagueRankLinks += '&lt;url&gt;&lt;loc&gt;https://pvpivs.com/leagueRanks.html?&amp;cp='+leagues[j]+'&amp;max='+levels[k]+'&lt;/loc&gt;&lt;changefreq&gt;always&lt;/changefreq&gt;&lt;priority&gt;0.9&lt;/priority&gt;&lt;/url&gt;<br />';
              first=false;}
              else continue;
            }
            /* Include language codes for the various languages supported by Search Strings page */
            for (var k=0; k<langs.length; k++) {
              /* Following formatting from Google Search Central: https://developers.google.com/search/docs/advanced/crawling/localized-versions#language-codes */
              searchStrLinks += '&lt;url&gt;&lt;loc&gt;https://pvpivs.com/searchStr.html?mon='+mon+'&amp;cp='+leagues[j]+'&amp;l='+langs[k]+'&lt;/loc&gt;';
              for (var l=0; l<langs.length; l++) {
                searchStrLinks += '&lt;xhtml:link rel="alternate" hreflang="'+langs[l]+'" href="https://pvpivs.com/searchStr.html?mon='+mon+'&amp;cp='+leagues[j]+'&amp;l='+langs[l]+'"/&gt;';
              }
              searchStrLinks += '&lt;changefreq&gt;always&lt;/changefreq&gt;&lt;priority&gt;0.7&lt;/priority&gt;&lt;/url&gt;<br />';
            }
          }
        }
        document.getElementById('feedbackBox').innerHTML = singleRankLinks + leagueRankLinks;
        if (perfTiming) {stopTiming(T0, "updateSitemap");}
      }
      
      function unitTests(testURLs) {
        if (!testURLs) {var testURLs = ["mon=Pidgeot&r=10&cp=2500&f=0&min=1&max=51&set=000000&fel=1500&mA=140.3&mD=130.1&mHP=164","mon=PidgEot&r=10&cp=2500&f=0&min=1&max=51"];}
        
        for (var i=0; i<testURLs.length;i++) {
          console.log("unitTests: "+i+": testing '"+testURLs[i]+"'");
          try {
            checkURI(testURLs[i]);
          }
          catch (err) {
            console.log("unitTests: "+i+": test generated error:'"+err+"'");
          }
          console.log("unitTests: "+i+": test complete");
        }
        console.log("unitTests: "+i+": testing pokeListAA not found");
        try {
          var pokeListCopy = pokeListAA;
          console.log("unitTests: "+i+": pokeListAA before: "+JSON.stringify(pokeListAA));
          pokeListAA = "";
          console.log("unitTests: "+i+": pokeListAA after: "+JSON.stringify(pokeListAA));
          main();
        } catch (err) {
          console.log("unitTests: "+i+": test generated error:'"+err+"'");
        }
        console.log("unitTests: "+i+": test complete");
        pokeListAA = pokeListCopy;
        return true;
      }
      
      function checkURI(URL, tests) {
        if (perfTiming) {var T0 = performance.now();}
        
        /* Read returning user's settings */
        checkUserPreference("limit,league,floor,minLvl,maxLvl,cmp,cge,family,familyEvoLeague,dti,dust,mlCP");
        
        if (!URL) {
          /* Not in test mode, parse URL for user inputs*/
          URL = window.location.href.split("?")[1];
          /*URL = "mon=Nidoqueen&r=66&cp=2500&max=50&set=100000&mA=151.98&mD=149.4&mHP=175&dec=2&IVs=7_14_9_true-6_10_8_true-9_12_15_true";*/
        } else {
          /* Enable unit testing */
          console.log("checkURI: URL passed in as:"+URL);
        }
        
        if (URL)
        {
          URL = decodeURI(URL);
          /*console.log("Read URL as: "+URL);*/
          var values = URL.split("&");
          /*console.log("Values array as: "+JSON.stringify(values));*/
          for (var i=0; i<values.length; i++)
          {
            switch (values[i].split("=")[0]) {
              case "mon":
                var poke = values[i].split("=")[1];
                if (pokeListAA[poke]) { /* Check for exact match */
                  console.log("checkURI: Found exact match:"+pokeListAA[poke]);
                } else {
                  if ((poke.includes("_PLACEHOLDER")) && pokeListAA[poke.split("_PLACEHOLDER")[0]]) {
                    poke = poke.split("_PLACEHOLDER")[0];
                    console.log("checkURI: Poke is placeholder, removed to now be:"+poke);
                  }
                  if ((poke.includes("_SPECULATIVE")) && pokeListAA[poke.split("_SPECULATIVE")[0]]) {
                  poke = poke.split("_SPECULATIVE")[0];
                  console.log("checkURI: Poke is speculative, removed to now be:"+poke);
                  }
                  /* Last ditch effort to fix capitalization mistakes via https://stackoverflow.com/a/4878800 */
                  var text = poke.toLowerCase()
                      .split('_')
                      .map((s) => s.charAt(0).toUpperCase() + s.substring(1))
                      .join('_');
                  if (pokeListAA[text]) {
                    poke = text;
                  } else {
                    console.log("checkURI: Could not find '"+text+"':"+pokeListAA[text]);
                    break;
                  }
                } /* However we found the right mon, select in textbox */
                document.querySelector("datalist").id = "pokeListDL";
                document.getElementById("pokeInput").value = poke;
                lastMon = poke;
                break;
              case "r":
                document.getElementById('limit').value = values[i].split("=")[1];
                break;
              case "cp":
                document.getElementById('league').value = values[i].split("=")[1];
                /* Catch incorrect CP values being passed in, default to Master League (false) */
                if (document.getElementById('league').value == "") {
                  console.error("checkURI: Unknown cp value detected, defaulting to Master League");
                  document.getElementById('league').value = false;
                }
                break;
              case "f":
                document.getElementById('floor').value = values[i].split("=")[1];
                break;
              case "min":
                document.getElementById('minLvl').value = values[i].split("=")[1];
                break;
              case "max":
                document.getElementById('maxLvl').value = values[i].split("=")[1];
                break;
              case "dec":
                document.getElementById('dec').value = values[i].split("=")[1];
                break;
              case "dti":
                document.getElementById('dti').checked = values[i].split("=")[1] ? true : false;
                break;
              case "cge":
                document.getElementById('cge').checked = values[i].split("=")[1] ? true : false;
                break;
              case "fam":
                document.getElementById('family').checked = values[i].split("=")[1] ? true : false;
                toggleFamilyEvos();
                break;
              case "fel":
                document.getElementById('familyEvoLeague').value = values[i].split("=")[1];
                /* Catch incorrect CP values being passed in, default to Master League (false) */
                if (document.getElementById('familyEvoLeague').value == "") {
                  console.error("checkURI: Unknown cp value detected, defaulting to Master League");
                  document.getElementById('familyEvoLeague').value = false;
                }
                break;
              case "cmp":
                document.getElementById('cmp').checked = values[i].split("=")[1] ? true : false;
                break;
              case "shdw":
                document.getElementById('shdw[0]').checked = values[i].split("=")[1] ? true : false;
                break;
              case "IVs":
                var ivStr = (values[i].split("=")[1]).split("-");
                for (var j=0; j<ivStr.length; j++)
                {
                  var userIVs = ivStr[j].split("_");
                  doTheInsert(userIVs[0],userIVs[1],userIVs[2],userIVs[3]);
                }
                /* Need to remove first row now */
                document.getElementById("minus[0]").click();
                console.log("checkURI: IVs set to aIV:"+aIV+", dIV:"+dIV+", sIV:"+sIV+", shdw:"+shdw);
                break;
              case "mA":
                mA = values[i].split("=")[1];
                break;
              case "mD":
                mD = values[i].split("=")[1];
                break;
              case "mHP":
                mHP = values[i].split("=")[1];
                break;
              case "t": /* Enable performance timing output in console for debugging */
                perfTiming = values[i].split("=")[1];
                break;
              case "test": /* Enable test mode for website unit testing and sitemap generation */
                console.log("checkURI: Reached 'test' case in URL switch...");
                if (URL == "sitemap") {
                  console.log("checkURI: Calling updateSitemap()");
                  updateSitemap();
                  console.log("checkURI: Updated sitemap output to console");
                  URL = "";
                  if (perfTiming) {stopTiming(T0, "checkURI");}
                  return true;
                }
                console.log("checkURI: Calling unitTests("+tests+")");
                unitTests(tests);
                console.log("checkURI: Finished all tests, exiting");
                if (perfTiming) {stopTiming(T0, "checkURI");}
                return true;
              case "set":
                /* settings = shdw,cmp,cge,family,dti,dust */
                var settings = (''+values[i].split("=")[1]);
                document.getElementById('mlCP').checked = settings[0]==1 ? true : false;
                document.getElementById('cmp').checked = settings[1]==1 ? true : false;
                document.getElementById('cge').checked = settings[2]==1 ? true : false;
                document.getElementById('family').checked = settings[3]==1 ? true : false;
                document.getElementById('dti').checked = settings[4]==1 ? true : false;
                document.getElementById('dust').checked = settings[5]==1 ? true : false;
                toggleFamilyEvos();
                break;
            }
          }
          /* If there's a poke, simulate Enter key press to start main() */
          if (document.getElementById("pokeInput").value) { /*https://stackoverflow.com/a/44190874*/
            if (perfTiming) {stopTiming(T0, "checkURI");}
            document.getElementById("pokeInput").dispatchEvent(new KeyboardEvent('keyup',{'key':'Enter'}));
          } else {
            console.log("checkURI: No poke detected, awaiting user input");
            if (perfTiming) {stopTiming(T0, "checkURI");}
          }
        }
        else
        {
          console.log("checkURI: No inputs detected, awaiting user input");
          if (perfTiming) {stopTiming(T0, "checkURI");}
        }
      }
      
      function cmpCalcs(ranks, keys, dec) {
        if (perfTiming) {var T0 = performance.now();}
        /*console.log("cmpCalcs: received: ranks: "+JSON.stringify(ranks)+", keys:"+JSON.stringify(keys))*/
        var print = false;

        /*walk all (4096) entries in ranks and compare*/
        for (var i=0; (i<ranks.numRanks && (keys[i].indexOf(".")>-1)); i++) {
            for (var j=0; j<ranks[keys[i]].length; j++) {
              if ((ranks[keys[i]][j].IVs.A/1 == 9) && (ranks[keys[i]][j].IVs.D/1 == 13) && (ranks[keys[i]][j].IVs.S/1 == 8)) {
                print = true;
              }
              if (numOut(ranks[keys[i]][j].battle.A,dec)/1 > numOut(ranks[keys[0]][0].battle.A,dec)/1) {
                /*if (print) { console.log("R1 set to W because numOut(ranks[keys[i]][j].battle.A,1):"+numOut(ranks[keys[i]][j].battle.A,1)+" > numOut(ranks[keys[0]][0].battle.A,1): "+numOut(ranks[keys[0]][0].battle.A,1));}*/
                ranks[keys[i]][j].IVs.R1 = "W";
                ranks[keys[i]][j].IVs.T100=1;
              } else if (numOut(ranks[keys[i]][j].battle.A,dec)/1 < numOut(ranks[keys[0]][0].battle.A,dec)/1) {
                /*if (print) { console.log("R1 set to L because numOut(ranks[keys[i]][j].battle.A,1):"+numOut(ranks[keys[i]][j].battle.A,1)+" < numOut(ranks[keys[0]][0].battle.A,1): "+numOut(ranks[keys[0]][0].battle.A,1));}*/
                ranks[keys[i]][j].IVs.R1 = "L";
                ranks[keys[i]][j].IVs.T100=0;
              } else {
                /*if (print) { console.log("R1 set to T because numOut(ranks[keys[i]][j].battle.A,1):"+numOut(ranks[keys[i]][j].battle.A,1)+" = numOut(ranks[keys[0]][0].battle.A,1): "+numOut(ranks[keys[0]][0].battle.A,1));}*/
                ranks[keys[i]][j].IVs.R1 = "T";
                ranks[keys[i]][j].IVs.T100=0;
              }
              for (var k=1,iters=1; ((iters<100) && (iters<ranks.numRanks)); k++) {
                /*console.log("Iterating through k="+k+": "+JSON.stringify(ranks[keys[k]]));*/
                for (var l=0; ((l<ranks[keys[k]].length) && (iters<100)); l++) {
                  if (numOut(ranks[keys[i]][j].battle.A,dec)/1 > numOut(ranks[keys[k]][l].battle.A,dec)/1) {ranks[keys[i]][j].IVs.T100+=1;}
                  iters = iters + 1;
                  /*if (print) { console.log("T100 increased to "+ranks[keys[i]][j].IVs.T100+" with numOut(ranks[keys[i]][j].battle.A,1):"+numOut(ranks[keys[i]][j].battle.A,1)+" > numOut(ranks[keys[k]][l].battle.A,1): "+numOut(ranks[keys[k]][l].battle.A,1));}*/
                }
              }
            if (print) {print = false;}
            }
        }
        if (perfTiming) {stopTiming(T0, "cmpCalcs");}
        return ranks;
      }
      
      function tradePcnts(ranks, keys, rank, floor, numIVs, aIV, dIV, sIV) {
        if (perfTiming) {var T0 = performance.now();}
        /*Keep track of eligible/total higher ranked mons*/
        var lGo=0,hGo=0,lGr=0,hGr=0,lUf=0,hUf=0,lBf=0,hBf=0,lLf=0,hLf=0,hNo=0;
        /*console.log("tradePcnts: received numRanks:"+ranks.numRanks+", keys[0]:"+keys[0]+", rank:"+rank+", floor:"+floor+", numIVs:"+numIVs+", aIV:"+aIV+", dIV:"+dIV+", sIV:"+sIV);*/

        var totalMons = 0;
        let i=0;
        for (i=0; (i<ranks.numRanks && (keys[i].indexOf(".")>-1)); i++) {
            for (var j=0; j<ranks[keys[i]].length; j++) {
              /*1IV=lGo,hGo + 2IV=lGr,hGr + 3IV=lUf,hUf + 5IV=lBf,hBf + 12V=lLf,hLf*/
              if ((ranks[keys[i]][j].IVs.A/1 > 11) && (ranks[keys[i]][j].IVs.D/1 > 11) && (ranks[keys[i]][j].IVs.S/1 > 11)) {
                if (rank/1<keys[i].split(".")[0]/1){
                  hLf=hLf+1;hBf=hBf+1;hUf=hUf+1;hGr=hGr+1;hGo=hGo+1;hNo=hNo+1;
                } else {
                  lLf=lLf+1;lBf=lBf+1;lUf=lUf+1;lGr=lGr+1;lGo=lGo+1;
                }
              } else if ((ranks[keys[i]][j].IVs.A/1 > 4) && (ranks[keys[i]][j].IVs.D/1 > 4) && (ranks[keys[i]][j].IVs.S/1 > 4)) {
                if (rank/1<keys[i].split(".")[0]/1) {
                  hBf=hBf+1;hUf=hUf+1;hGr=hGr+1;hGo=hGo+1;hNo=hNo+1;
                } else {
                  lBf=lBf+1;lUf=lUf+1;lGr=lGr+1;lGo=lGo+1;
                }
              } else if ((ranks[keys[i]][j].IVs.A/1 > 2) && (ranks[keys[i]][j].IVs.D/1 > 2) && (ranks[keys[i]][j].IVs.S/1 > 2)) {
                if (rank/1 < keys[i].split(".")[0]/1) {
                  hUf=hUf+1;hGr=hGr+1;hGo=hGo+1;hNo=hNo+1;
                } else {
                  lUf=lUf+1;lGr=lGr+1;lGo=lGo+1;
                }
              } else if ((ranks[keys[i]][j].IVs.A/1 > 1) && (ranks[keys[i]][j].IVs.D/1 > 1) && (ranks[keys[i]][j].IVs.S/1 > 1)) {
                if (rank/1 < keys[i].split(".")[0]/1) {
                  hGr=hGr+1;hGo=hGo+1;hNo=hNo+1;
                } else {
                  lGr = lGr + 1;lGo = lGo + 1;
                }
              } else if ((ranks[keys[i]][j].IVs.A/1 > 0) && (ranks[keys[i]][j].IVs.D/1 > 0) && (ranks[keys[i]][j].IVs.S/1 > 0)) {
                if (rank/1 < keys[i].split(".")[0]/1) {
                  hGo=hGo+1;hNo=hNo+1;
                } else {
                  lGo=lGo+1;
                }
              } else {
                if (rank/1 < keys[i].split(".")[0]/1) {
                  hNo=hNo+1;
                }
              }
            totalMons = totalMons + 1;
            }
        }
        
        /* Count up invalid CP combinations by friendship (over CP cap) */
        var iGo=0,iGr=0,iUf=0,iBf=0,iLf=0,iNo=0;
        for (i=0; i<ranks.invalids.length; i++) {
          if ((ranks.invalids[i].A/1 > 11) && (ranks.invalids[i].D/1 > 11) && (ranks.invalids[i].S/1 > 11)) {
            iLf=iLf+1;iBf=iBf+1;iUf=iUf+1;iGr=iGr+1;iGo=iGo+1;iNo=iNo+1;
          } else if ((ranks.invalids[i].A/1 > 4) && (ranks.invalids[i].D/1 > 4) && (ranks.invalids[i].S/1 > 4)) {
            iBf=iBf+1;iUf=iUf+1;iGr=iGr+1;iGo=iGo+1;iNo=iNo+1;
          } else if ((ranks.invalids[i].A/1 > 2) && (ranks.invalids[i].D/1 > 2) && (ranks.invalids[i].S/1 > 2)) {
            iUf=iUf+1;iGr=iGr+1;iGo=iGo+1;iNo=iNo+1;
          } else if ((ranks.invalids[i].A/1 > 1) && (ranks.invalids[i].D/1 > 1) && (ranks.invalids[i].S/1 > 1)) {
            iGr=iGr+1;iGo=iGo+1;iNo=iNo+1;
          } else if ((ranks.invalids[i].A/1 > 0) && (ranks.invalids[i].D/1 > 0) && (ranks.invalids[i].S/1 > 0)) {
            iGo=iGo+1;iNo=iNo+1;
          } else {
            iNo=iNo+1;
          }
        }
        
        /* v:"valid" ranks, h:"higher" rank, l:"lower" rank, i:"invalid" (over CP cap), t:"total" ranks, u:% "under" CP cap*/
        var vNo=ranks.numRanks, vGo=hGo+lGo, vGr=hGr+lGr, vUf=hUf+lUf, vBf=hBf+lBf, vLf=hLf+lLf;
        var tNo=vNo+iNo, tGo=vGo+iGo, tGr=vGr+iGr, tUf=vUf+iUf, tBf=vBf+iBf, tLf=vLf+iLf;
        var uNo=(100*vNo/tNo).toFixed(2), uGo=(100*vGo/tGo).toFixed(2), uGr=(100*vGr/tGr).toFixed(2), uUf=(100*vUf/tUf).toFixed(2), uBf=(100*vBf/tBf).toFixed(2), uLf=(100*vLf/tLf).toFixed(2);
        var cNo=uNo*(10000*hNo/vNo).toFixed(1), cGo=uGo*(10000*hGo/vGo).toFixed(1), cGr=uGr*(10000*hGr/vGr).toFixed(1), cUf=uUf*(10000*hUf/vUf).toFixed(1), cBf=uBf*(10000*hBf/vBf).toFixed(1), cLf=uLf*(10000*hLf/vLf).toFixed(1);
        
        /*highlight higest chance row*/
        var nfCls="",gdfCls="",grfCls="",ufCls="",bfCls="",lfCls="",clsVal="";
        
        /* Initialize with "None" Friends */var maxVal=cNo/1;var maxType = "None"; /*none friends pcnt*/
        if ((floor/1 < 2) && (maxVal/1<=cGo/1)){maxVal=cGo/1;maxType="Good";}/*check good friends pcnt*/
        if ((floor/1 < 3) && (maxVal/1<=cGr/1)){maxVal=cGr/1;maxType="Great";}/*check great friends pcnt*/
        if ((floor/1 < 4) && (maxVal/1<=cUf/1)){maxVal=cUf/1;maxType="Ultra";}/*check ultra friends pcnt*/
        if ((floor/1 < 6) && (maxVal/1<=cBf/1)){maxVal=cBf/1;maxType="Best";}/*check best friends pcnt*/
        if (maxVal/1<=cLf/1){maxVal=cLf/1;maxType="Lucky";}/*check lucky friends pcnt*/
        
        /* Only highlight if chance to improve is non-zero */
        if (maxVal) {
          /* control highlighting of table rows based on trade improvement percentage chance */
          if (maxVal/10000 > 60) {clsVal = "highMaxRow";}
          else if (maxVal/10000 > 40) {clsVal = "okMaxRow";}
          else {clsVal = "lowMaxRow";}
        }
        
        /* determine which row should be highlighted, others left blank / not assigned a class */
        switch(maxType) {
          case "None":nfCls=" class='"+clsVal+"'";break;
          case "Good":gdfCls=" class='"+clsVal+"'";break;
          case "Great":grfCls=" class='"+clsVal+"'";break;
          case "Ultra":ufCls=" class='"+clsVal+"'";break;
          case "Best":bfCls=" class='"+clsVal+"'";break;
          case "Lucky":lfCls=" class='"+clsVal+"'";break;
        }
        
        var outHTML = "";
        if (numIVs/1 > 1) {
          outHTML += "<p><i>Trade Improvement % Table for IVs:"+ aIV+"/"+dIV+"/"+sIV+"</i></p>";
        }
        outHTML += "<table id='tradeTable'><th>Friendship</th><th>Chance to Improve</th><th>Higher Rank</th><th>Same/ Lower</th>";
        var printIVU = false;
        if ((iGo+iGr+iUf+iBf+iLf+iNo) > 0)
        { /* Don't print these columns if they're empty */
          outHTML += "<th>Invalid</th><th>Valid</th><th>% Under</th>";
          printIVU = true;
        }
        outHTML += "<th>Total</th>";
        
        if ((floor/1 < 1) && (ranks.numRanks)) { /*don't print unless the IV floor is 0, or if there are no eligible mons*/
          outHTML += "<tr"+nfCls+"><td>None (IV&ge;0)</td><td>"+(cNo/10000).toFixed(3)+"%</td><td>"+hNo+"</td><td>"+(ranks.numRanks-hNo)/1+"</td>";
          if (printIVU) { outHTML += "<td>"+iNo+"</td><td>"+vNo+"</td><td>"+(1*uNo).toFixed(2)+"%</td>"; }
          outHTML += "<td>"+tNo+"</td></tr>";
        }
        
        if ((floor/1 < 2) && vGo) { /*don't print if the IV floor is above 1, or if there are no eligible Gof mons*/
          outHTML += "<tr"+gdfCls+"><td>Good (IV&ge;1)</td><td>"+(cGo/10000).toFixed(3)+"%</td><td>"+hGo+"</td><td>"+lGo+"</td>";
          if (printIVU) { outHTML += "<td>"+iGo+"</td><td>"+vGo+"</td><td>"+(1*uGo).toFixed(2)+"%</td>"; }
          outHTML += "<td>"+tGo+"</td></tr>";
        }
        
        if ((floor/1 < 3) && vGr) { /*don't print if IV floor is above 2, or if there are no eligible Grf mons*/
          outHTML += "<tr"+grfCls+"><td>Great (IV&ge;2)</td><td>"+(cGr/10000).toFixed(3)+"%</td><td>"+hGr+"</td><td>"+lGr+"</td>";
          if (printIVU) { outHTML += "<td>"+iGr+"</td><td>"+vGr+"</td><td>"+(1*uGr).toFixed(2)+"%</td>"; }
          outHTML += "<td>"+tGr+"</td></tr>";
        }
        
        if ((floor/1 < 4) && vUf) { /*don't print if IV floor is above 3, or if there are no eligible Uf mons*/
          outHTML += "<tr"+ufCls+"><td>Ultra (IV&ge;3)</td><td>"+(cUf/10000).toFixed(3)+"%</td><td>"+hUf+"</td><td>"+lUf+"</td>";
          if (printIVU) { outHTML += "<td>"+iUf+"</td><td>"+vUf+"</td><td>"+(1*uUf).toFixed(2)+"%</td>"; }
          outHTML += "<td>"+tUf+"</td></tr>";
        }
        
        if ((floor/1 < 6) && vBf){ /*don't print if IV floor is above 5, or if there are no eligible Bf mons*/
          outHTML += "<tr"+bfCls+"><td>Best (IV&ge;5)</td><td>"+(cBf/10000).toFixed(3)+"%</td><td>"+hBf+"</td><td>"+lBf+"</td>";
          if (printIVU) { outHTML += "<td>"+iBf+"</td><td>"+vBf+"</td><td>"+(1*uBf).toFixed(2)+"%</td>"; }
          outHTML += "<td>"+tBf+"</td></tr>";
        }
        
        if ((floor/1 < 13) && vLf) { /*don't print if IV floor is above 12, or if there are no eligible Lf mons*/
        outHTML += "<tr"+lfCls+"><td>Lucky (IV&ge;12)</td><td>"+(cLf/10000).toFixed(3)+"%</td><td>"+hLf+"</td><td>"+lLf+"</td>";
          if (printIVU) { outHTML += "<td>"+iLf+"</td><td>"+vLf+"</td><td>"+(1*uLf).toFixed(2)+"%</td>"; }
          outHTML += "<td>"+tLf+"</td></tr></table>";
        }
        if (perfTiming) {stopTiming(T0, "tradePcnts");}
        return outHTML;
      }
      
      function getMonRank(ranks, keys, shdw, cmp, maxStatProd, aIV, dIV, sIV, mA, mD, mHP, filtered, numIVs, mon, uri, maxLvl, dust, dec, mlCP) {
        if (perfTiming) {var T0 = performance.now();}
        /*console.log("gMR: received: ranks:"+ranks+", keys[0]:"+keys[0]+", maxStatProd:"+maxStatProd+", aIV:"+aIV+", dIV:"+dIV+", sIV:"+sIV+", mon:"+mon+", uri:"+uri);*/
        var html = "";
        var actualRank = 1;
        var validIVs = false;

        for (var i=0; (i<ranks.numRanks && ranks[keys[i]].length); i++) {
          for (var j=0; j<ranks[keys[i]].length; j++) {
            if ((aIV/1 == ranks[keys[i]][j].IVs.A/1) && (dIV/1 == ranks[keys[i]][j].IVs.D/1) && (sIV/1 == ranks[keys[i]][j].IVs.S/1)) {
              /*control highlight of User Data row based on rank*/
              /*this has been moved to CSS Stylings as of re-write*/
              if (actualRank/1 < (0.02442*ranks.numRanks/1)) {
                html+="<tr class='good'>"; /*green for "good"*/
              } else if (actualRank/1 < (0.2442*ranks.numRanks/1)) {
                html+="<tr class='ok'>"; /*orange for "ok"*/
              } else {
                html+="<tr class='rubbish'>"; /*red for "rubbish"*/
              }
              
              /*Pokemon	Rank	Lvl	CP	%	PvP Atk	PvP Def	PvP HP	Stat Prod*/
              /*output the row for this individual mon*/
              /*if there is an evo mon passed in, print/exclude certain rows*/
              /*allows for more code re-use / less versioning to maintain*/
              if (mon) {
                html+="<td><a href='"+encodeURI(uri)+"'>"+mon+"</a></td>"; /*evos[e] aka evoName*/
                if (numIVs/1 > 1) {
                  html+="<td>"+ranks[keys[i]][j].IVs.A+"/"+ranks[keys[i]][j].IVs.D+"/"+ranks[keys[i]][j].IVs.S+"</td>"; /*evoIVs*/
                }
              }
              html+="<td>"+actualRank+"</td>"; /*Rank*/
              html+="<td>"+ranks[keys[i]][j].L+"</td>"; /*Level*/
              html+="<td>"+ranks[keys[i]][j].CP+"</td>"; /*Final CP*/
              if (!mon) { /*skip if this is an evoTable print*/
              if (mlCP) {html+="<td>"+Math.max(10, Math.floor((pokeListAA[poke].split(',')[1]/1 + ranks[keys[i]][j].IVs.A) * Math.sqrt(pokeListAA[poke].split(',')[2]/1 + ranks[keys[i]][j].IVs.D) * Math.sqrt(pokeListAA[poke].split(',')[3]/1 + ranks[keys[i]][j].IVs.S) * cpm[(document.getElementById('minLvl').value-1)*2] * cpm[(document.getElementById('minLvl').value-1)*2] / 10))+"</td>"; /*Raid/Hatch CP*/}
                html+="<td>"+ranks[keys[i]][j].IVs.A+"</td>"; /*Atk IV*/
                html+="<td>"+ranks[keys[i]][j].IVs.D+"</td>"; /*Def IV*/
                html+="<td>"+ranks[keys[i]][j].IVs.S+"</td>"; /*Sta IV*/
                rIV.push(actualRank); /*Save rank for trash string links*/
                lvl.push(ranks[keys[i]][j].L); /*Save levels for PvPoke Custom Group Export*/
              }
              html+="<td>"+parseFloat((100*keys[i].split(".")[0])/maxStatProd).toFixed(2)+"%"+"</td>"; /*Perfection*/
              if(!mon) {
                if (maxLvl > 41 && ranks.maxLvl>41) {html+=shdw ? "<td style='color:purple'>" : "<td>";html+=XLcandy(ranks[keys[i]][j].L/1 - 40, shdw)+"</td>";}
                if (dust) {html+= shdw ? "<td style='color:purple'>" : "<td>";html+=stardust(document.getElementById('minLvl').value/1, ranks[keys[i]][j].L/1, 0,shdw)+"</td>";}
                if (cmp) {
                    html+="<td>"+ranks[keys[i]][j].IVs.R1+"</td>"; /*R1 CMP*/
                    html+="<td>"+ranks[keys[i]][j].IVs.T100+"%"+"</td>"; /*T100 CMP*/
                }
              }
              html+="<td>"+numOut(ranks[keys[i]][j].battle.A,dec)+"</td>"; /*GL Atk Total*/
              html+="<td>"+numOut(ranks[keys[i]][j].battle.D,dec)+"</td>"; /*GL Def Total*/
              html+="<td>"+ranks[keys[i]][j].battle.S+"</td>"; /*GL Sta IV*/
              html+="<td>"+keys[i].split(".")[0]+"</td></tr>"; /*Stat Product*/
              /*console.log("Found rank="+actualRank);*/
              
              /* Check if these IVs are valid or invalid for user filter feeedback */
              if (filtered && (mA/1 <= numOut(ranks[keys[i]][j].battle.A,dec)) && (mD/1 <= numOut(ranks[keys[i]][j].battle.D,dec)) && (mHP/1 <= ranks[keys[i]][j].battle.S)) {
                validIVs = true;
              }
              
              break; /* we found it, stop searching / leave the loop!*/
            }
            actualRank = actualRank + 1;
          }
        }
        
        if (perfTiming) {stopTiming(T0, "getMonRank");}
        return [html, validIVs];
      }
      
      function XLcandy(xlev, shdw) {
        /* Returns calculated XL candy costs based on https://bulbapedia.bulbagarden.net/wiki/Power_Up#CP_multiplier */
        switch (xlev) {
          case 11:
          case 10:
            if (shdw) {return 360;}
            return 296;
          case 10.5:
          case 9.5:
            if (shdw) {return 336;}
            return 276;
          case 9:
            if (shdw) {return 312;}
            return 256;
          case 8.5:
            if (shdw) {return 288;}
            return 236;
          case 8:
            if (shdw) {return 264;}
            return 216;
          case 7.5:
            if (shdw) {return 243;}
            return 199;
          case 7:
            if (shdw) {return 222;}
            return 182;
          case 6.5:
            if (shdw) {return 201;}
            return 165;
          case 6:
            if (shdw) {return 180;}
            return 148;
          case 5.5:
            if (shdw) {return 162;}
            return 133;
          case 5:
            if (shdw) {return 144;}
            return 118;
          case 4.5:
            if (shdw) {return 126;}
            return 103;
          case 4:
            if (shdw) {return 108;}
            return 88;
          case 3.5:
            if (shdw) {return 93;}
            return 76;
          case 3:
            if (shdw) {return 78;}
            return 64;
          case 2.5:
            if (shdw) {return 63;}
            return 52;
          case 2:
            if (shdw) {return 48;}
            return 40;
          case 1.5:
            if (shdw) {return 36;}
            return 30;
          case 1:
            if (shdw) {return 24;}
            return 20;
          case 0.5:
            if (shdw) {return 12;}
            return 10;
          default:
            return 0;
        }
      }
      
      function stardust(startlvl, endlvl, totaldust, shdw) {
        /* Returns calculated stardust power-up costs based on https://bulbapedia.bulbagarden.net/wiki/Power_Up#CP_multiplier*/
        while (startlvl < endlvl) {
          switch (startlvl) {
            case 1:
            case 2:
              startlvl+=1;totaldust+=400;break;
            case 3:
            case 4:
              startlvl+=1;totaldust+=800;break;
            case 5:
            case 6:
              startlvl+=1;totaldust+=1200;break;
            case 7:
            case 8:
              startlvl+=1;totaldust+=1600;break;
            case 9:
            case 10:
              startlvl+=1;totaldust+=2000;break;
            case 11:
            case 12:
              startlvl+=1;totaldust+=2600;break;
            case 13:
            case 14:
              startlvl+=1;totaldust+=3200;break;
            case 15:
            case 16:
              startlvl+=1;totaldust+=3800;break;
            case 17:
            case 18:
              startlvl+=1;totaldust+=4400;break;
            case 19:
            case 20:
              startlvl+=1;totaldust+=5000;break;
            case 21:
            case 22:
              startlvl+=1;totaldust+=6000;break;
            case 23:
            case 24:
              startlvl+=1;totaldust+=7000;break;
            case 25:
            case 26:
              startlvl+=1;totaldust+=8000;break;
            case 27:
            case 28:
              startlvl+=1;totaldust+=9000;break;
            case 29:
            case 30:
              startlvl+=1;totaldust+=10000;break;
            case 31:
            case 32:
              startlvl+=1;totaldust+=12000;break;
            case 33:
            case 34:
              startlvl+=1;totaldust+=14000;break;
            case 35:
            case 36:
              startlvl+=1;totaldust+=16000;break;
            case 37:
            case 38:
              startlvl+=1;totaldust+=18000;break;
            case 39:
            case 40:
              startlvl+=1;totaldust+=20000;break;
            case 41:
            case 42:
              startlvl+=1;totaldust+=22000;break;
            case 43:
            case 44:
              startlvl+=1;totaldust+=24000;break;
            case 45:
            case 46:
              startlvl+=1;totaldust+=26000;break;
            case 47:
            case 48:
              startlvl+=1;totaldust+=28000;break;
            case 49:
              startlvl+=1;totaldust+=30000;break;
            case 50:
            case 51:
              startlvl+=1;break;
          }
        }
        /* Adjust for shadow power up penalty */
        if (shdw) {
          totaldust = totaldust*1.2;
        }
        if (totaldust > 1000) {
          totaldust = Math.round(totaldust/1000) + "K";
        }
        return totaldust;
      }
      
      function validTyroEvo(aIV, dIV, sIV, evo) {
        if (perfTiming) {var T0 = performance.now();}
        if (aIV/1 === dIV/1 && aIV/1 === sIV/1) {console.log("validTyroEvo: All IVs equal, random evo (showing all 3)"); if (perfTiming) {stopTiming(T0, "validTyroEvo");}return false;
          } else if (aIV/1 === dIV/1 || aIV/1 === sIV/1 || dIV/1 === sIV/1) {
            if (aIV/1 === dIV/1) {
              if ((sIV/1 < aIV/1) && (evo == "Hitmontop")) {
                console.log("validTyroEvo: Stamina is lowest, skipping Hitmontop evo");
                if (perfTiming) {stopTiming(T0, "validTyroEvo");}
                return true; /*skip Hitmontop*/
              } else if ((sIV/1 > aIV/1) && (evo != "Hitmontop")) {
                console.log("validTyroEvo: Stamina is highest, skipping non-Hitmontop evo");
                if (perfTiming) {stopTiming(T0, "validTyroEvo");}
                return true; /*only show Hitmontop*/
              }
            } else if (dIV/1 === sIV/1) {
              if ((aIV/1 < dIV/1) && (evo == "Hitmonlee")) {
                console.log("validTyroEvo: Attack is lowest, skipping Hitmonlee evo");
                if (perfTiming) {stopTiming(T0, "validTyroEvo");}
                return true; /*skip Hitmonlee*/
              } else if ((aIV/1 > dIV/1) && (evo != "Hitmonlee")) {
                console.log("validTyroEvo: Attack is highest, skipping non-Hitmonlee evo");
                if (perfTiming) {stopTiming(T0, "validTyroEvo");}
                return true; /*only show Hitmonlee*/
              }
            } else if (aIV/1 === sIV/1) {
              if ((dIV/1 < sIV/1) && (evo == "Hitmonchan")) {
                console.log("validTyroEvo: Defense is lowest, skipping Hitmonchan evo");
                if (perfTiming) {stopTiming(T0, "validTyroEvo");}
                return true; /*skip Hitmonchan*/
              } else if ((dIV/1 > sIV/1) && (evo != "Hitmonchan")) {
                console.log("validTyroEvo: Defense is highest, skipping non-Hitmonchan evo");
                if (perfTiming) {stopTiming(T0, "validTyroEvo");}
                return true; /*only show Hitmonchan*/
              }
            }
          } else if ((aIV/1 > dIV/1) && (aIV/1 > sIV/1)) {
              if (evo != "Hitmonlee") {/*Only show Hitmonlee*/
                console.log("validTyroEvo: Attack is highest, skipping non-Hitmonlee evo");
                if (perfTiming) {stopTiming(T0, "validTyroEvo");}
                return true; }
          } else if ((dIV/1 > sIV/1) && (dIV/1 > aIV/1)) {
            if (evo != "Hitmonchan") {/*Only show Hitmonchan*/
              console.log("validTyroEvo: Defense is highest, skipping non-Hitmonchan evo");
              if (perfTiming) {stopTiming(T0, "validTyroEvo");}
              return true; }
          } else if ((sIV/1 > dIV/1) && (sIV/1 > aIV/1)) {
            if (evo != "Hitmontop") {/*Only show Hitmontop*/
              console.log("validTyroEvo: Stamina is highest, skipping non-Hitmontop evo");
              if (perfTiming) {stopTiming(T0, "validTyroEvo");}
              return true; }
          } else {console.error("validTyroEvo: Not sure how this is possible?");if (perfTiming) {stopTiming(T0, "validTyroEvo");}return false;}
        if (perfTiming) {stopTiming(T0, "validTyroEvo");}
        return false;
      }
      
      function doTheInsert(atk, def, sta, sha) {
        if (perfTiming) {var T0 = performance.now();}
        
        var newRow=document.getElementById('inputTable').insertRow();
        var shadowCB = document.getElementsByClassName('shadowCB');
        
        newRow.innerHTML = "<tr><td><input class='shadowCB' id='shdw["+shadowCB.length+"]' type='checkbox' oninput='shdwUpdater()'></td><td><select title='Your Attack IV' class='aIV' id='aIV["+aIV.length+"]' oninput='main()'><option value=''></option><option value='15'>15</option><option value='14'>14</option><option value='13'>13</option><option value='12'>12</option><option value='11'>11</option><option value='10'>10</option><option value='9'>9</option><option value='8'>8</option><option value='7'>7</option><option value='6'>6</option><option value='5'>5</option><option value='4'>4</option><option value='3'>3</option><option value='2'>2</option><option value='1'>1</option><option value='0'>0</option></select></td><td><select title='Your Defense IV' class='dIV' id='dIV["+dIV.length+"]' oninput='main()'><option value='15'>15</option><option value='14'>14</option><option value='13'>13</option><option value='12'>12</option><option value='11'>11</option><option value='10'>10</option><option value='9'>9</option><option value='8'>8</option><option value='7'>7</option><option value='6'>6</option><option value='5'>5</option><option value='4'>4</option><option value='3'>3</option><option value='2'>2</option><option value='1'>1</option><option value='0'>0</option></select></td><td><select title='Your Stamina IV' class='sIV' id='sIV["+sIV.length+"]' oninput='main()'><option value='15'>15</option><option value='14'>14</option><option value='13'>13</option><option value='12'>12</option><option value='11'>11</option><option value='10'>10</option><option value='9'>9</option><option value='8'>8</option><option value='7'>7</option><option value='6'>6</option><option value='5'>5</option><option value='4'>4</option><option value='3'>3</option><option value='2'>2</option><option value='1'>1</option><option value='0'>0</option></select></td><td><button class='circle minus' id='minus["+shadowCB.length+"]' onclick='doTheRemoval()'></button></td></tr>";
        
        /* Check if this row should have default IVs or specific IVs */
        if (!(atk && def && sta)) {
          console.log("doTheInsert: Missing one or more IVs, inserting default values");
          atk = '';
          def = '15';
          sta = '15';
        } else {
          document.getElementById("aIV["+aIV.length+"]").selectedIndex = [...document.getElementById("aIV["+aIV.length+"]").options].findIndex (option => option.text === atk);
          document.getElementById("dIV["+dIV.length+"]").selectedIndex = [...document.getElementById("dIV["+dIV.length+"]").options].findIndex (option => option.text === def);
          document.getElementById("sIV["+sIV.length+"]").selectedIndex = [...document.getElementById("sIV["+sIV.length+"]").options].findIndex (option => option.text === sta);
          document.getElementById("shdw["+(shadowCB.length-1)+"]").checked = (sha == "true") ? true: false;
        }
        aIV.push(atk);
        dIV.push(def);
        sIV.push(sta);
        shdw.push(sha);
        
        if (perfTiming) {stopTiming(T0, "doTheInsert");}
      }
      
      /* https://stackoverflow.com/q/11553768 */
      function doTheRemoval() {
        if (perfTiming) {var T0 = performance.now();}
        /*event.target will be the input element*/
        /*console.log("doTheRemoval: event.target.parentNode.parentNode:"+JSON.stringify(event.target.parentNode.parentNode.innerHTML));*/
        var td = event.target.parentNode;
        var tr = td.parentNode; /*the row to be removed*/
        var rowNum = tr.innerHTML.split("aIV[")[1];
        rowNum = rowNum.split("]")[0];
        for (var i=0; i<aIV.length; i++)
        {
          if (i>=rowNum) {
            /*console.log("Fixing offset for i:"+i);*/
            document.getElementById("shdw["+i+"]").id = "shdw["+(i-1)+"]";
            document.getElementById("aIV["+i+"]").id = "aIV["+(i-1)+"]";
            document.getElementById("dIV["+i+"]").id = "dIV["+(i-1)+"]";
            document.getElementById("sIV["+i+"]").id = "sIV["+(i-1)+"]";
          }
        }
        aIV.splice(rowNum, 1);
        dIV.splice(rowNum, 1);
        sIV.splice(rowNum, 1);
        shdw.splice(rowNum, 1);
        tr.parentNode.removeChild(tr);
        
        /* If we removed all rows, add one back */
        if (aIV.length/1 < 1) {
          doTheInsert();
        }
        if (perfTiming) {stopTiming(T0, "doTheRemoval");}
        main();
      }
      </script>
      <div style="overflow-x:auto;" id="timing_outputs"></div>
      <h3>Settings:</h3>
      <label>IV Floor:<select id="floor" oninput="setUserPreference('floor')">
        <option value="0">0: Wild Caught</option>
        <option value="1">1: Trade, Good Friend</option>
        <option value="2">2: Trade, Great / Purified</option>
        <option value="3">3: Trade, Ultra Friend</option>
        <option value="4">4: Weather Boost</option>
        <option value="5">5: Trade, Best Friend</option>
        <option value="6">6: Shadow Legendary</option>
        <option value="10">10: Raid / Hatch</option>
        <option value="12">12: Lucky Trade</option>
      </select></label><br />
      <label>Min Level:<select title="What Level Floor to Search?" id="minLvl" oninput="setUserPreference('minLvl')">
        <option value="1">1: Wild Caught</option>
        <option value="2">2</option>
        <option value="3">3</option>
        <option value="4">4</option>
        <option value="5">5</option>
        <option value="6">6</option>
        <option value="7">7</option>
        <option value="8">8</option>
        <option value="9">9</option>
        <option value="10">10</option>
        <option value="11">11</option>
        <option value="12">12</option>
        <option value="13">13</option>
        <option value="14">14</option>
        <option value="15">15: Research Reward</option>
        <option value="16">16</option>
        <option value="17">17</option>
        <option value="18">18</option>
        <option value="19">19</option>
        <option value="20">20: Raid / Hatch</option>
        <option value="21">21</option>
        <option value="22">22</option>
        <option value="23">23</option>
        <option value="24">24</option>
        <option value="25">25: Purified</option>
        <option value="26">26</option>
        <option value="27">27</option>
        <option value="28">28</option>
        <option value="29">29</option>
        <option value="30">30</option>
        <option value="31">31</option>
        <option value="32">32</option>
        <option value="33">33</option>
        <option value="34">34</option>
        <option value="35">35</option>
        <option value="36">36</option>
        <option value="37">37</option>
        <option value="38">38</option>
        <option value="39">39</option>
        <option value="40">40</option>
      </select></label><br />
      <label>Max Level:<select title="What Level Ceiling to Search?" id="maxLvl" oninput="setUserPreference('maxLvl')">
        <option value="1">1: Wild Caught</option>
        <option value="2">2</option>
        <option value="3">3</option>
        <option value="4">4</option>
        <option value="5">5</option>
        <option value="6">6</option>
        <option value="7">7</option>
        <option value="8">8</option>
        <option value="9">9</option>
        <option value="10">10</option>
        <option value="11">11</option>
        <option value="12">12</option>
        <option value="13">13</option>
        <option value="14">14</option>
        <option value="15">15: Research Reward</option>
        <option value="16">16</option>
        <option value="17">17</option>
        <option value="18">18</option>
        <option value="19">19</option>
        <option value="20">20: Raid Reward</option>
        <option value="21">21</option>
        <option value="22">22</option>
        <option value="23">23</option>
        <option value="24">24</option>
        <option value="25">25: Purified</option>
        <option value="26">26</option>
        <option value="27">27</option>
        <option value="28">28</option>
        <option value="29">29</option>
        <option value="30">30</option>
        <option value="31">31</option>
        <option value="32">32</option>
        <option value="33">33</option>
        <option value="34">34</option>
        <option value="35">35</option>
        <option value="36">36</option>
        <option value="37">37</option>
        <option value="38">38</option>
        <option value="39">39</option>
        <option selected value="40">40</option>
        <option value="41">41</option>
        <option value="42">42</option>
        <option value="43">43</option>
        <option value="44">44</option>
        <option value="45">45</option>
        <option value="46">46</option>
        <option value="47">47</option>
        <option value="48">48</option>
        <option value="49">49</option>
        <option value="50">50</option>
        <option value="51">51: Best Buddy</option>
        <option value="52">52 (SPECULATIVE)</option>
        <option value="53">53 (SPECULATIVE)</option>
        <option value="54">54 (SPECULATIVE)</option>
        <option value="55">55 (SPECULATIVE)</option>
      </select></label><br />
      <label>PvP Stat Decimal Places:<input title="How many decimal places to Output?" type="number" value="1" id="dec" min="1" oninput="setUserPreference('dec')"></label><br />
      <label>Include CMP Tie Breaking:<input id="cmp" type="checkbox" oninput="setUserPreference('cmp')"></label><br />
      <label>Export PvPoke Custom Group:<input id="cge" type="checkbox" oninput="setUserPreference('cge')"></label><br />
      <label>Show Family Evolutions:<input id="family" type="checkbox" oninput="toggleFamilyEvos()"></label><br />
      <div id="familyEvoLeagueDiv"><label id="familyEvoLeagueLbl" for="familyEvoLeague" style="display: none;">Family Evos League:
        <select id="familyEvoLeague" oninput="setUserPreference('familyEvoLeague')">
          <option value="500" label="Little Leagues">Little Leagues</option>
          <option value="1500" selected label="Great League">Great League</option>
      		<option value="2500" label="Ultra League">Ultra League</option>
      		<option value="false" label="Master League">Master League</option>
      	</select></label>
      </div>
      <label>Show Trade Improvement %:<input id="dti" type="checkbox" oninput="setUserPreference('dti')"></label><br />
      <label>Show Stardust Power-Up Costs:<input id="dust" type="checkbox" oninput="setUserPreference('dust')"></label><br />
      <label>Show Min Level CP (Raid/Hatch):<input id="mlCP" type="checkbox" oninput="setUserPreference('mlCP')"></label><br />
      <label>Remember My Settings:<input id="save" type="checkbox" oninput="saveCurrentSettings()"></label><br />
      <button id="resetButton" type="resetSettings" onclick="localStorage.clear();location.reload();">Reset All Saved Settings to Defaults</button>

      <br />
      <div style="overflow-x:auto;">
        <p style="color:silver;font-size:0.6em">This site uses Google Analytics and the Google
        <a style="color:#AED6F1" href="https://policies.google.com/privacy">Privacy Policy</a> and
        <a style="color:#AED6F1" href="https://policies.google.com/terms">Terms of Service</a> apply.<br /><br />
      </div>
    </section>
  </body>
</html>