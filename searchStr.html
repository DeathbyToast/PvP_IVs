<!DOCTYPE html>
<html lang="en">
  <head>
    <!-- Google Tag Manager -->
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
    j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
    'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-TDF58VB');</script>
    <!-- End Google Tag Manager -->
    <meta charset="UTF-8">
    <link rel="canonical" href="https://pvpivs.com/searchStr.html" />
    <!-- Include pre-loads to reduce/optimize page load time-->
    <link rel="preload" href="https://pvpivs.com/includes/style.css" as="style">
    <link rel="preload" href="https://pvpivs.com/includes/footer.js" as="script">
    <link rel="preload" href="https://pvpivs.com/includes/calculate.js" as="script">
    <link rel="preload" href="https://cdnjs.cloudflare.com/ajax/libs/awesomplete/1.1.5/awesomplete.min.css" as="style">
    <link rel="preload" href="https://cdnjs.cloudflare.com/ajax/libs/awesomplete/1.1.5/awesomplete.min.js" as="script">
    <link rel="preload" href="https://pvpivs.com/includes/pokeListGen8.js" as="script">
    <title>PvP IVs - Search Strings</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="Pok&eacute;mon Go&trade; PvP IVs search string generator finds your best PvP IVs and/or helps you send the rest to Professor Willow. Now able to search for / exclude 0% IVs!"/>
    <link rel=icon href=/includes/favicon.png>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/awesomplete/1.1.5/awesomplete.min.css">
    <link rel="stylesheet" href="https://pvpivs.com/includes/style.css">
    <style>
    .evoLimits{
      display:none;
    }
    input[type=number]{
      width: 42px;
    }
    </style>
  </head>
<body class="light-theme" onload="checkURI()">
  <!-- Google Tag Manager (noscript) -->
  <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-TDF58VB"
  height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
  <!-- End Google Tag Manager (noscript) -->
  <header>
    <ul class="header">
      <li class="dropdown active left">
        <a href="javascript:void(0)" class="dropbtn active">PvP IVs</a>
        <div class="dropdown-content">
          <a href="/">Rankings (Single)</a>
          <a href="/leagueRanks.html">Rankings (League)</a>
          <a href="/searchStr.html" class="active">Search Strings</a>
        </div>
      </li>
      <li class="dropdown left">
        <a href="javascript:void(0)" class="dropbtn">Typing</a>
        <div class="dropdown-content">
          <a href="/typeLookup.html">Chart</a>
          <a href="/typeQuiz.html">Quiz</a>
        </div>
      </li>
      <li class="flat right">
        <a href="/about.html">About</a>
      </li>
      <li class="flat right">
          <label class="theme-toggle-switch">
            <img id="theme-toggle-icon" src="https://pvpivs.com/includes/dark_mode_icon_white-fill.png" alt="Dark Mode" width="22" height="22">
            <div>
              <input id="theme-toggle" type="checkbox" />
              <span class="slider round"></span>
            </div>
          </label>
        </li>
    </ul>
  </header>
  <section>
    <br />
    <input id="pokeList" onfocus="this.value=''" placeholder="Final Mon"/>
    <label>League:<select id="league" oninput="main()">
      <option value="500">Little Leagues</option>
        <option value="1500" selected>Great League</option>
    		<option value="2500">Ultra League</option>
    		<option value="false">Master League</option>
  		<option value="All">All Leagues</option></select>
  	</label><br />
    <label id="getStarted"><i>Please first select an evolution family above, then boxes to select Top # Ranks per evo will appear...</i><br /></label>
    <div class="evoLimits" id="evoLimits[1]"><input id="evoCB[1]" class="evoCBs" type="checkbox" onclick="main()"><div id="evoName[1]"></div>
      <div id="GLlimitDiv[1]"><label id="labelGLlimit[1]" for="GLlimit[1]">GL:</label><input type="number" value="10" id="GLlimit[1]" min="1" max="4096" oninput="main()"></div>
      <div id="ULlimitDiv[1]"><label id="labelULlimit[1]" for="ULlimit[1]">UL:</label><input type="number" value="10" id="ULlimit[1]" min="1" max="4096" oninput="main()"></div>
      <div id="MLlimitDiv[1]"><label id="labelMLlimit[1]" for="MLlimit[1]">ML:</label><input type="number" value="10" id="MLlimit[1]" min="1" max="4096" oninput="main()"></div>
    <br /></div>
    <div class="evoLimits" id="evoLimits[2]"><input id="evoCB[2]" class="evoCBs" type="checkbox" onclick="main()"><div id="evoName[2]"></div>
      <div id="GLlimitDiv[2]"><label id="labelGLlimit[2]" for="GLlimit[2]">GL:</label><input type="number" value="10" id="GLlimit[2]" min="1" max="4096" oninput="main()"></div>
      <div id="ULlimitDiv[2]"><label id="labelULlimit[2]" for="ULlimit[2]">UL:</label><input type="number" value="10" id="ULlimit[2]" min="1" max="4096" oninput="main()"></div>
      <div id="MLlimitDiv[2]"><label id="labelMLlimit[2]" for="MLlimit[2]">ML:</label><input type="number" value="10" id="MLlimit[2]" min="1" max="4096" oninput="main()"></div>
    <br /></div>
    <div class="evoLimits" id="evoLimits[3]"><input id="evoCB[3]" class="evoCBs" type="checkbox" onclick="main()"><div id="evoName[3]"></div>
      <div id="GLlimitDiv[3]"><label id="labelGLlimit[3]" for="GLlimit[3]">GL:</label><input type="number" value="10" id="GLlimit[3]" min="1" max="4096" oninput="main()"></div>
      <div id="ULlimitDiv[3]"><label id="labelULlimit[3]" for="ULlimit[3]">UL:</label><input type="number" value="10" id="ULlimit[3]" min="1" max="4096" oninput="main()"></div>
      <div id="MLlimitDiv[3]"><label id="labelMLlimit[3]" for="MLlimit[3]">ML:</label><input type="number" value="10" id="MLlimit[3]" min="1" max="4096" oninput="main()"></div>
    <br /></div>
    <div class="evoLimits" id="evoLimits[4]"><input id="evoCB[4]" class="evoCBs" type="checkbox" onclick="main()"><div id="evoName[4]"></div>
      <div id="GLlimitDiv[4]"><label id="labelGLlimit[4]" for="GLlimit[4]">GL:</label><input type="number" value="10" id="GLlimit[4]" min="1" max="4096" oninput="main()"></div>
      <div id="ULlimitDiv[4]"><label id="labelULlimit[4]" for="ULlimit[4]">UL:</label><input type="number" value="10" id="ULlimit[4]" min="1" max="4096" oninput="main()"></div>
      <div id="MLlimitDiv[4]"><label id="labelMLlimit[4]" for="MLlimit[4]">ML:</label><input type="number" value="10" id="MLlimit[4]" min="1" max="4096" oninput="main()"></div>
    <br /></div>
    <div class="evoLimits" id="evoLimits[5]"><input id="evoCB[5]" class="evoCBs" type="checkbox" onclick="main()"><div id="evoName[5]"></div>
      <div id="GLlimitDiv[5]"><label id="labelGLlimit[5]" for="GLlimit[5]">GL:</label><input type="number" value="10" id="GLlimit[5]" min="1" max="4096" oninput="main()"></div>
      <div id="ULlimitDiv[5]"><label id="labelULlimit[5]" for="ULlimit[5]">UL:</label><input type="number" value="10" id="ULlimit[5]" min="1" max="4096" oninput="main()"></div>
      <div id="MLlimitDiv[5]"><label id="labelMLlimit[5]" for="MLlimit[5]">ML:</label><input type="number" value="10" id="MLlimit[5]" min="1" max="4096" oninput="main()"></div>
    <br /></div>
    <div class="evoLimits" id="evoLimits[6]"><input id="evoCB[6]" class="evoCBs" type="checkbox" onclick="main()"><div id="evoName[6]"></div>
      <div id="GLlimitDiv[6]"><label id="labelGLlimit[6]" for="GLlimit[6]">GL:</label><input type="number" value="10" id="GLlimit[6]" min="1" max="4096" oninput="main()"></div>
      <div id="ULlimitDiv[6]"><label id="labelULlimit[6]" for="ULlimit[6]">UL:</label><input type="number" value="10" id="ULlimit[6]" min="1" max="4096" oninput="main()"></div>
      <div id="MLlimitDiv[6]"><label id="labelMLlimit[6]" for="MLlimit[6]">ML:</label><input type="number" value="10" id="MLlimit[6]" min="1" max="4096" oninput="main()"></div>
    <br /></div>
    <div class="evoLimits" id="evoLimits[7]"><input id="evoCB[7]" class="evoCBs" type="checkbox" onclick="main()"><div id="evoName[7]"></div>
      <div id="GLlimitDiv[7]"><label id="labelGLlimit[7]" for="GLlimit[7]">GL:</label><input type="number" value="10" id="GLlimit[7]" min="1" max="4096" oninput="main()"></div>
      <div id="ULlimitDiv[7]"><label id="labelULlimit[7]" for="ULlimit[7]">UL:</label><input type="number" value="10" id="ULlimit[7]" min="1" max="4096" oninput="main()"></div>
      <div id="MLlimitDiv[7]"><label id="labelMLlimit[7]" for="MLlimit[7]">ML:</label><input type="number" value="10" id="MLlimit[7]" min="1" max="4096" oninput="main()"></div>
    <br /></div>
    <div class="evoLimits" id="evoLimits[8]"><input id="evoCB[8]" class="evoCBs" type="checkbox" onclick="main()"><div id="evoName[8]"></div>
      <div id="GLlimitDiv[8]"><label id="labelGLlimit[8]" for="GLlimit[8]">GL:</label><input type="number" value="10" id="GLlimit[8]" min="1" max="4096" oninput="main()"></div>
      <div id="ULlimitDiv[8]"><label id="labelULlimit[8]" for="ULlimit[8]">UL:</label><input type="number" value="10" id="ULlimit[8]" min="1" max="4096" oninput="main()"></div>
      <div id="MLlimitDiv[8]"><label id="labelMLlimit[8]" for="MLlimit[8]">ML:</label><input type="number" value="10" id="MLlimit[8]" min="1" max="4096" oninput="main()"></div>
    <br /></div>
    <div class="evoLimits" id="evoLimits[9]"><input id="evoCB[9]" class="evoCBs" type="checkbox" onclick="main()"><div id="evoName[9]"></div>
      <div id="GLlimitDiv[9]"><label id="labelGLlimit[9]" for="GLlimit[9]">GL:</label><input type="number" value="10" id="GLlimit[9]" min="1" max="4096" oninput="main()"></div>
      <div id="ULlimitDiv[9]"><label id="labelULlimit[9]" for="ULlimit[9]">UL:</label><input type="number" value="10" id="ULlimit[9]" min="1" max="4096" oninput="main()"></div>
      <div id="MLlimitDiv[9]"><label id="labelMLlimit[9]" for="MLlimit[9]">ML:</label><input type="number" value="10" id="MLlimit[9]" min="1" max="4096" oninput="main()"></div>
    <br /></div>
    <div id="errorBox"></div>
    <br /><br />
      <textarea id="output" rows="10" style="width: 95%; height: 50%;" onclick="autocopy(this)"></textarea>
      <div id="outputSummaryBox"></div>
      <div id="feedbackBox"></div><br />
    <br /><br />
      <!-- Footer Code Below -->
    <script src="https://pvpivs.com/includes/footer.js"></script>
    <script src="https://pvpivs.com/includes/calculate.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/awesomplete/1.1.5/awesomplete.min.js"></script>
    <script src="https://pvpivs.com/includes/pokeListGen8.js"></script>
    <script>
    /* define Awesomeplete list https://leaverou.github.io/awesomplete/ */
    var input = document.getElementById("pokeList");
    var selected = undefined;
    var perfTiming = false; /* used for timing execution */
    
    /* Ensure we've successfully loaded a pokeList */
    if (!(pokeList.length))
    {
      console.log("ERROR: Failed to load pokeList!");
    } else {
      /* Yes we have a valid pokeList, build awesomplete search box */
      var awesomplete = new Awesomplete(input, {list: pokeList,
      	/* insert label instead of value into the input */
      	replace: function(suggestion) {
      		this.input.value = suggestion.label;
      		selected = suggestion.label;
      		main(true);
      	}
      });
      /* end Awesomeplete definitions https://leaverou.github.io/awesomplete/ */
    }
  
    function checkURI() {
      if (perfTiming) {var checkURIT0 = performance.now();}
      var URL = window.location.href.split("?")[1];
      /*var URL = "mon=Dusknoir&cp=1500&r=f_10_f_f&o=1001100&l=en";*/
      
      if (URL)
      {
        URL = decodeURI(URL);
        /*console.log("Read URL as: "+URL);*/
        var values = URL.split("&"), i, j;
        /*console.log("Values array as: "+JSON.stringify(values));*/
        for (i=0; i<values.length; i++)
        {
          switch (values[i].split("=")[0]) {
            case "mon":
              selected = values[i].split("=")[1];
              /* Conditional for ALl Zero mode */
              if (!selected) {
                document.getElementById('allZero').checked = true;
              } else {
                awesomplete.input.value = selected;
              }
              break;
              
            case "r":
              var rStr = (values[i].split("=")[1]).split("_");
              /*console.log("Received rStr:"+rStr);*/
              for (j=0; j<rStr.length; j++) {
                if (rStr[j] != "f") {
                  var limits = (rStr[j]).split("-");
                  /*console.log("Processing rStr["+j+"]: "+rStr[j]+" and limits:"+limits);*/
                  document.getElementById('evoCB['+(j+1)+']').checked = true;
                  
                  switch (document.getElementById('league').value) {
                    case "All":
                      document.getElementById('GLlimit['+(j+1)+']').value = limits[0];
                      document.getElementById('ULlimit['+(j+1)+']').value = limits[1];
                      document.getElementById('MLlimit['+(j+1)+']').value = limits[2];
                      document.getElementById('GLlimit['+(j+1)+']').style="display: inline-block;"; document.getElementById('labelGLlimit['+(j+1)+']').style="display: inline-block;";
                      document.getElementById('ULlimit['+(j+1)+']').style="display: inline-block;"; document.getElementById('labelULlimit['+(j+1)+']').style="display: inline-block;";
                      document.getElementById('MLlimit['+(j+1)+']').style="display: inline-block;"; document.getElementById('labelMLlimit['+(j+1)+']').style="display: inline-block;";
                      break;
                    case "500":
                      document.getElementById('GLlimit['+(j+1)+']').value = limits[0];
                      document.getElementById('GLlimit['+(j+1)+']').style="display: inline-block;"; document.getElementById('labelGLlimit['+(j+1)+']').style="display: inline-block;";
                      document.getElementById('ULlimit['+(j+1)+']').style="display: none;"; document.getElementById('labelULlimit['+(j+1)+']').style="display: none;";
                      document.getElementById('MLlimit['+(j+1)+']').style="display: none;"; document.getElementById('labelMLlimit['+(j+1)+']').style="display: none;";
                      break;
                    case "1500":
                      document.getElementById('GLlimit['+(j+1)+']').value = limits[0];
                      document.getElementById('GLlimit['+(j+1)+']').style="display: inline-block;"; document.getElementById('labelGLlimit['+(j+1)+']').style="display: inline-block;";
                      document.getElementById('ULlimit['+(j+1)+']').style="display: none;"; document.getElementById('labelULlimit['+(j+1)+']').style="display: none;";
                      document.getElementById('MLlimit['+(j+1)+']').style="display: none;"; document.getElementById('labelMLlimit['+(j+1)+']').style="display: none;";
                      break;
                    case "2500":
                      document.getElementById('ULlimit['+(j+1)+']').value = limits[0];
                      document.getElementById('GLlimit['+(j+1)+']').style="display: none;"; document.getElementById('labelGLlimit['+(j+1)+']').style="display: none;";
                      document.getElementById('ULlimit['+(j+1)+']').style="display: inline-block;"; document.getElementById('labelULlimit['+(j+1)+']').style="display: inline-block;";
                      document.getElementById('MLlimit['+(j+1)+']').style="display: none;"; document.getElementById('labelMLlimit['+(j+1)+']').style="display: none;";
                      break;
                    default:
                      document.getElementById('MLlimit['+(j+1)+']').value = limits[0];
                      document.getElementById('GLlimit['+(j+1)+']').style="display: inline-block;"; document.getElementById('labelGLlimit['+(j+1)+']').style="display: inline-block;";
                      document.getElementById('ULlimit['+(j+1)+']').style="display: inline-block;"; document.getElementById('labelULlimit['+(j+1)+']').style="display: inline-block;";
                      document.getElementById('MLlimit['+(j+1)+']').style="display: none;"; document.getElementById('labelMLlimit['+(j+1)+']').style="display: none;";
                  }
                } else {
                  if (j>0) {document.getElementById('evoCB['+(j+1)+']').value = false;}
                }
              }
              break;
              
            case "cp":
              document.getElementById('league').value = values[i].split("=")[1];
              break;
              
            case "o":
            case "set":
              var settings = (''+values[i].split("=")[1]);
                document.getElementById('trash').checked = settings[0]==1 ? true : false;
                document.getElementById('onlyZero').checked = settings[1]==1 ? true : false;
                document.getElementById('trashHundo').checked = settings[2]==1 ? true : false;
                document.getElementById('trashZero').checked = settings[3]==1 ? true : false;
                document.getElementById('base').checked = settings[4]==1 ? true : false;
                document.getElementById('baby').checked = settings[5]==1 ? true : false;
                document.getElementById('allZero').checked = settings[6]==1 ? true : false;
                document.getElementById('customIVs').checked = settings[7]==1 ? true : false;
              break;
              
            case "l":
              var lang = document.getElementById('lang');
              var languages = lang.options.length;
              for (j=0; j<languages; j++) {
                if (lang.options[j].value.split(",")[0] == values[i].split("=")[1]) {
                  lang.options[j].selected = true;
                  break;
                }
              }
              break;
              
            case "m": /* Enable Levels beyond 40 for Search Strings */
              document.getElementById('maxLvl').value = values[i].split("=")[1];
              break;
              
            case "s": /* Enable Search Level filtering for Search Strings */
              document.getElementById('searchLvl').value = values[i].split("=")[1];
              break;
              
            case "t": /* Enable performance timing output in console for debugging */
              perfTiming = values[i].split("=")[1];
              break;
            
            case "skips":
              document.getElementById('dexSkips').value = values[i].split("=")[1];
              break;
            
            case "IVentry":
              document.getElementById('IVentry').value = values[i].split("=")[1];
              break;
          }
        }
        /* Conditional for All Zero mode */
        if (document.getElementById('allZero').checked) {
          console.log("Detected All Zero mode");
          /* Override CP Limit for allZero mode */
          document.getElementById('league').value = document.getElementById('cpLimit').value;
        }
        
        if (perfTiming) {var checkURIT1 = performance.now();
        console.log("checkURI: Execution took "+(checkURIT1-checkURIT0).toFixed(1)+"ms");}
        main();
        return true;
      }
      else
      {
        console.log("No inputs detected, awaiting user input");
        if (perfTiming) {var checkURIT1 = performance.now();
        console.log("checkURI: Execution took "+(checkURIT1-checkURIT0).toFixed(1)+"ms");}
        return false;
      }
    }
    
    function main(newMon) {
      if (perfTiming) {var mainT0 = performance.now();}
      
      /* Reset all evoLimits / name divs */
  		for (var i=1; i<10; i++) {
  		  document.getElementById('evoName['+i+']').innerHTML = "";
    		document.getElementById('evoName['+i+']').style.display = "none";
    		document.getElementById('evoLimits['+i+']').style.display = "none";
    		if (newMon) { /* Only reset these if a new mon is selected */
    		  document.getElementById('evoCB['+i+']').checked = false;
      		document.getElementById('GLlimit['+i+']').value = "10";
      		document.getElementById('ULlimit['+i+']').value = "10";
      		document.getElementById('MLlimit['+i+']').value = "10";
    		}
  		}
  		
  		/* Ensure messages from prior runs are cleared */
  		document.getElementById('feedbackBox').innerHTML = "";
      document.getElementById("errorBox").innerHTML = "";
      document.getElementById("overflowArea").innerHTML = "";
      document.getElementById("outputSummaryBox").innerHTML = "";
      
      /* Hide/Show advanced Settings as appropriate */
      if (document.getElementById('trash').checked) {document.getElementById('trashAdv').style.display = "block";}
      else {document.getElementById('trashAdv').style.display = "none";}
      
      var league = document.getElementById('league').value;
      var leagueName = document.getElementById('league').options[document.getElementById('league').selectedIndex].innerHTML;
      var trash = document.getElementById('trash').checked;
      var trashHundo = document.getElementById('trashHundo').checked;
      var trashZero = document.getElementById('trashZero').checked;
      var onlyZero = document.getElementById('onlyZero').checked;
      var lang = document.getElementById('lang').value.split(',');
      var maxLvl = document.getElementById('maxLvl').value;
      
      /* See if this was a request for all-mon Zero IV string */
      if (document.getElementById('allZero').checked) {
        document.getElementById('getStarted').style.display = "none";
        var cpLimit = document.getElementById('cpLimit').value;
        var dexSkips = document.getElementById('dexSkips').value;
        document.getElementById("cpLimit").style.display = "inline-block";
        document.getElementById("cpLimitLbl").style.display = "inline-block";
        document.getElementById("dexSkips").style.display = "inline-block";
        document.getElementById("dexSkipsLbl").style.display = "inline-block";
        
        /* convert to array for concat, then sort, then de-dupe */
        dexSkips = dexSkips.substring(0, dexSkips.length).split`,`.map(x=>+x);
        dexSkips = [...new Set(dexSkips.concat(boxRewrd,raidOnly,boxMyth,raidMyth).sort())];
        /* can only find zero IVs from wild spawns, merge, sort, and de-dupe non-wild spawning dex nums */
        findAllZeros(cpLimit, dexSkips);
        
        /* Ensure we update the URL before returning */
        updateURI(false,league,leagueName,lang[0],);
        return;
      } else {
        document.getElementById("cpLimit").style.display = "none";
        document.getElementById("cpLimitLbl").style.display = "none";
        document.getElementById("dexSkips").style.display = "none";
        document.getElementById("dexSkipsLbl").style.display = "none";
      }
      
      /* See if this was a request for custom IV Search String */
      if (document.getElementById('customIVs').checked) {
        console.log("Custom IV entry detected");
        document.getElementById('getStarted').style.display = "none";
        var customIVs = document.getElementById('IVentry').value;
        document.getElementById("IVentry").style.display = "inline-block";
        document.getElementById("IVentryLbl").style.display = "inline-block";
        
        /* Separate and format customIVs, starting with whitespace */
        customIVs = customIVs.split(/[ ,]+/);
        for (i=0; i<customIVs.length; i++) {
          /* Strip out IV separators and save each IV */
          customIVs[i] = customIVs[i].split(/[^0-9]+/);
          customIVs[i].A = customIVs[i][0];
          customIVs[i].D = customIVs[i][1];
          customIVs[i].S = customIVs[i][2];
        }
        /*console.log("Finished processing customIVs: "+JSON.stringify(customIVs));*/
        document.getElementById('feedbackBox').innerHTML = "<p><i>Read custom IVs as: "+JSON.stringify(customIVs)+"</i></p>";
        /* Finish later after initial evoVals building */
      } else {
        document.getElementById("IVentry").style.display = "none";
        document.getElementById("IVentryLbl").style.display = "none";
      }
      
      /* exit if we haven't selected a mon yet */
      if ((awesomplete.suggestions === undefined) && (selected === undefined)) {
        console.log("No Pok&eacute;mon found by main(), received:'"+awesomplete.suggestions+"' and '"+selected+"'");
        document.getElementById('getStarted').style.display = "block";
        document.getElementById('output').value = "";
        return;
      } else {
        if (selected === undefined) {
          console.log("Invalid input detected:'"+awesomplete.suggestions+"' and '"+selected+"'");
          return;
        } else {
          console.log("main: Found mon in both:'"+awesomplete.suggestions+"' and '"+selected+"'");
          /* We have a valid mon, hide the 'getting started' mon selection help text */
          document.getElementById('getStarted').style.display = "none";
        }
      }
      
      var mon = '';
      /* need to ensure we have the right mon selected */
      if (awesomplete.suggestions !== undefined) {
        for (i=0; i<awesomplete.suggestions.length; i++)
        {
          if (selected == awesomplete.suggestions[i].label)
          {
            /*console.log("mon set to selected == awesomplete.suggestions["+i+"].label:"+awesomplete.suggestions[i].label) */
            mon = awesomplete.suggestions[i].value;
          }
        }
      } else {
        /* need to ensure we have the right mon selected */
        var listLen = awesomplete.options.list.length;
        for (i=0; i<listLen; i++)
        {
          if (selected == awesomplete.options.list[i].label)
          {
            /*console.log("mon set to selected == awesomplete.suggestions["+i+"].label:"+awesomplete.suggestions[i].label) */
            mon = awesomplete.options.list[i].value;
          }
        }
      }
      
      var value = mon.split(',');
      var output = document.getElementById('output');
      var evoVals = [];
      
      /* Strip out atk/def/sta stats, leave only dex numbers with &alola,etc */
      var evoFamily = value.slice(4,value.length);
      evoFamily.unshift(value[0]); /* add selected to front to complete evoFamily */

      /* Check if this family has a baby mon */
      if (evoFamily.some(res => res.includes("eggsonly"))) {
        /* Found a baby, unhide baby option */
        document.getElementById("babyLbl").style.display = "inline-block";
        document.getElementById("baby").style.display = "inline-block";
        /* Find baby name and add to label to reduce confusion */
        var babyDex = (evoFamily.filter(item => (item.indexOf("&eggsonly") != -1)))[0];
        var babyMon = pokeList[(pokeList.findIndex(e => e.value.split(",")[0] === babyDex))].label;
        document.getElementById("babyLbl").innerHTML = "Search for "+babyMon+" (Baby Evo):";
      } else {
        /* Otherwise reset to default hidden status, default text */
        document.getElementById("babyLbl").style.display = "none";
        document.getElementById("baby").style.display = "none";
        document.getElementById("babyLbl").innerHTML = "Search for Baby Evo:";
        document.getElementById('baby').checked = false;
      }
      
      if ((document.getElementById('base').checked ===  false) && (document.getElementById('baby').checked === true)) {
        /* Using baby without base is not supported, force true */
        document.getElementById('base').checked = true;
        console.log("Must select 'base' to run with 'baby' selected, please try again");
        document.getElementById('errorBox').innerHTML = "<p><i>Please uncheck 'Search for Baby Evo' first</i></p>";
      }
      
      /* Remove baby from evoFamily if it is not checked/used */
      if (document.getElementById('baby').checked === false) {
        evoFamily = evoFamily.filter(item => (item.indexOf("&eggsonly") < 0));
      }
      
      console.log("Building evoVals array with evoFamily as: "+JSON.stringify(evoFamily));
      
      /**
       * Finds mon names and base stats from their nums
       * in values from Awesomeplete array via findIndex
       *
       * evoVals[0] = baseVals; (base or baby) - 125 or 239 (Elbz)
       * evoVals[1] = finalVals; (selected or highest Dex) - 466
       * evoVals[2...] = evoVals; (all other evos) 125?
       **/
      for (i=0; i<evoFamily.length; i++) {
        /* find evo name from pokeList for each evoFamily entry */
        var indexPL = pokeList.findIndex(e => e.value.split(",")[0] === evoFamily[i]);
        var splitValue = pokeList[indexPL].value.split(",");
  
        /** Initialize evoVals as defined:
         * ex: ["485",251,213,209,"Heatran",3754,10,10,10]
         * evoVals[][0] = dexNum as placeholder
         * evoVals[][1] = base attack stat
         * evoVals[][2] = base defense stat
         * evoVals[][3] = base stamina stat
         * evoVals[][4] = Awesomplete label (mon name)
         * evoVals[][5] = Max CP (calculated)
         *** FINISHED LATER ON AFTER SORTING ***
         **/
  
        evoVals[i] = new Array(9).fill(0);
        evoVals[i][0] = splitValue[0];
        evoVals[i][1] = splitValue[1]/1;
        evoVals[i][2] = splitValue[2]/1;
        evoVals[i][3] = splitValue[3]/1;
        evoVals[i][4] = pokeList[indexPL].label;
        evoVals[i][5] = Math.max(10, Math.floor((evoVals[i][1]/1 + 15) * Math.sqrt(evoVals[i][2]/1 + 15) * Math.sqrt(evoVals[i][3]/1 + 15) * cpm[(maxLvl - 1)*2] * cpm[(maxLvl - 1)*2] / 10))/1;
      }
      
      /* Only run if there are evolutions, skip for Heatmor, etc */
      if (evoVals.length > 1) {
        
        /* Sort evoVals by maxCP (evoVals[][5]) to find true base mon */
        evoVals = evoVals.sort(function(a, b) { return a[5] - b[5];});
        console.log("Sorted evoVals["+evoVals.length+"]: "+JSON.stringify(evoVals));
        
        /* Verify evoVals[0] contains base (or baby) */
        if (document.getElementById("baby").checked === true) {
          if (!evoVals[0][0].includes("eggsonly")) {
            /* baby is not at first slot, need to find it and copy it to 0 index */
            evoVals.unshift([...evoVals[evoVals.findIndex(mon => mon[0].includes("eggsonly"))]]); /* Don't just copy pointer, copy values! */
            console.log("evoVals after unshift: "+JSON.stringify(evoVals));
          }
          /* Hide base label to avoid confusion */
          console.log("Baby detected, hiding base...");
          document.getElementById("baseLbl").style.display = "none";
          document.getElementById("base").style.display = "none";
          document.getElementById("baseLbl").innerHTML = "Search for Base Evo:";
        } else {
          if (!evoVals[0][0].includes("b")) {
            /* base is not at first slot, need to find it and copy it to 0 index */
            evoVals.unshift([...evoVals[evoVals.findIndex(mon => mon[0].includes("b"))]]);
            console.log("evoVals after unshift: "+JSON.stringify(evoVals));
          }
          
          /* There are evolutions, unhide base option */
          console.log("Evos detected, showing base...");
          document.getElementById("baseLbl").style.display = "inline-block";
          document.getElementById("base").style.display = "inline-block";
          /* Add base name to label to reduce confusion */
          document.getElementById("baseLbl").innerHTML = "Search for "+evoVals[0][4]+" (Base Evo):";
        }
  
        /* If base could also be an evo, add duplicate entry */
        /* Example test cases: Rhyhorn, Electabuzz */
        if (((evoVals[0][5] > 400) && (league == "500")) ||
            ((evoVals[0][5] > 1350) && ((league == "1500") || (league ==  "All"))) ||
            ((evoVals[0][5] > 2250) && ((league == "2500") || (league ==  "All"))) ||
            ((evoVals[0][5] > 2500) && ((league =="false") || (league ==  "All")))) {
          console.log("Detected base ("+evoVals[0][4]+") that could be evo, duplicating...");
          evoVals.push([...evoVals[0]]); /* Don't just copy pointer, copy values! */
          console.log("evoVals after duplication push: "+JSON.stringify(evoVals));
        }
      } else {
        /* Otherwise reset to default hidden status, default text */
        console.log("No evos detected, hiding base...");
        document.getElementById("baseLbl").style.display = "none";
        document.getElementById("base").style.display = "none";
        document.getElementById("baseLbl").innerHTML = "Search for Base Evo:";
        /* Duplicate the only entry to ensure we have a final mon to output */
        evoVals.push([...evoVals[0]]); /* Don't just copy pointer, copy values! */
      }
      
      /* Add base/baby name to Output Levels label */
      document.getElementById("searchLvlLbl").innerHTML = "Search "+evoVals[0][4]+" Levels:";
      
      /* Ensure we have a clean dex number to output */
      evoVals[0][0] = evoVals[0][0].split("b").join("");
      
      /* Ensure that at least one box is checked for output */
      if (selected === evoVals[0][4] && newMon) {
        /* Base is selected, ensure nothing is checked */
        for (i=1; i<evoVals.length; i++) {
          if (document.getElementById('evoCB['+i+']').checked === true) {
            break;
            console.log("Found a checked box! Won't check others");
          }
        }
        if (i == evoVals.length) {
          console.log("Looks like no boxes are checked yet...");
          /* No boxes are checked, let's ensure highest CP non-mega mon is checked */
          for (i=evoVals.length-1; i>0; i--) {
            if (!evoVals[i][4].includes("Mega")) {
              document.getElementById('evoCB['+i+']').checked = true;
              console.log("Checked the box for "+evoVals[i][4]);
              break;
            }
          }
        }
      }
      
       /* If this was a request for custom IV Search String, output custom IV string */
      if (document.getElementById('customIVs').checked) {
        /* Set final evo stats if they exist, otherwise copy base mon stats */
        var finalEvoAtk = evoVals[2]?.[1] ? evoVals[2][1] : evoVals[0][1];
        var finalEvoDef = evoVals[2]?.[2] ? evoVals[2][2] : evoVals[0][2];
        var finalEvoSta = evoVals[2]?.[3] ? evoVals[2][3] : evoVals[0][3];
        outputCustomIVsStr(customIVs, evoVals[0][1], evoVals[0][2], evoVals[0][3], finalEvoAtk, finalEvoDef, finalEvoSta, league, output, lang, maxLvl, evoVals[0][0], evoVals[0][4]);
        
        /* Ensure we update the URL before returning */
        updateURI(selected,league,leagueName,lang[0],);
        return;
      }
      
      /**
       * Unhides all checkboxes for family evos, and fills
       * league limits as appropriate for all evolutions.
       **/
      for (i=1; i<evoVals.length; i++) {
        
        /* Ensure selected mon's checkbox starts checked */
        if (selected === evoVals[i][4] && newMon) {
          document.getElementById('evoCB['+i+']').checked = true;
          /*console.log("auto-checked evoCB["+i+"]");*/
        }
  
        /** Fill evoVals as defined:
         * ex: ["485",251,213,209,"Heatran",3754,10,10,10]
         * evoVals[][0] = dexNum or "false" if unchecked */
        evoVals[i][0] = document.getElementById('evoCB['+i+']').checked ? evoVals[i][0] : false;
        console.log("document.getElementById("+evoVals[i][4]+").checked: "+document.getElementById('evoCB['+i+']').checked);
        /**...below already filled previously...
         * ...evoVals[][1] = base attack stat
         * ...evoVals[][2] = base defense stat
         * ...evoVals[][3] = base stamina stat
         * ...evoVals[][4] = Awesomplete label (mon name)
         * ...evoVals[][5] = Max CP (calculated)
         * ...above already filled previously...
         * evoVals[][6] = Great  League #ranks
         * evoVals[][7] = Ultra  League #ranks
         * evoVals[][8] = Master League #ranks
         **/
        
        /* Unhide and fill evoName[]s as appropriate */
        if (evoVals[i].indexOf("&eggsonly") == -1) { /* skip showing checkbox for baby evos */
          document.getElementById('evoName['+i+']').innerHTML = evoVals[i][4]+" ("+evoVals[i][5]+")";
          document.getElementById('evoName['+i+']').style="display: inline-block;";
          document.getElementById('evoLimits['+i+']').style="display: inline-block;";/*style="display: none;";*/
          document.getElementById('GLlimitDiv['+i+']').style.display = ((league == "All") || (league == "500") || (league == "1500")) ? "inline-block" : "none";
          document.getElementById('ULlimitDiv['+i+']').style.display = ((league == "All") || (league == "2500")) ? "inline-block" : "none";
          document.getElementById('MLlimitDiv['+i+']').style.display = ((league == "All") || (league === "false")) ? "inline-block" : "none";
          /*console.log("Added "+evoVals[i][4]+" to list, un-hid evoLimits["+i+"]");*/
        }
    
        evoVals[i][6] = ((league == "All") || (league == "1500") || (league == "500")) ? document.getElementById('GLlimit['+i+']').value/1:0*1;
        evoVals[i][7] = ((evoVals[i][5] > 1500) && ((league == "All") || (league == "2500"))) ? document.getElementById('ULlimit['+i+']').value/1:0*1;
        /* Set Master League limits if this is the selected mon, or if CP>2500 AND the league is either All or Master League */
        evoVals[i][8] = (((evoVals[i][4] == value[0]) || (evoVals[i][5] > 2500)) && ((league == "All") || (league === "false"))) ? document.getElementById('MLlimit['+i+']').value/1:0*1;
      }
      console.log("Finished building evoVals[]: "+JSON.stringify(evoVals));
      
      /* Ensure that we have at least one evolution checked (evoCB) https://stackoverflow.com/a/22938796 */
      const evoCBs = [...document.getElementsByClassName("evoCBs")]; /* add override to build base mon search strings for <500CP Leagues */
      if ((evoCBs.filter(input => input.checked).length === 0) && (document.getElementById("base").checked == false)) {
        console.log("ERROR: No evolutions selected, exiting...");
        document.getElementById('errorBox').innerHTML = "<p>ERROR: No Evolution(s) checked to output! Please check at least one Evolution box above and try again.</p>";
        document.getElementById('output').value = "";
        return false;
      }
      
      /* output the user's request! */
      outputStr(evoVals, trash, trashHundo, trashZero, onlyZero, league, output, lang, maxLvl);
      
      /* update the URL with search parameters */
      updateURI(selected,league,leagueName,lang[0],evoVals.length);
      
      if (perfTiming) {var mainT1 = performance.now();
      console.log("main: Execution took "+(mainT1-mainT0).toFixed(1)+"ms");}
      return true;
    }
    
    function encodeSettings(evoLen)
    {
      /* build binary encoding of settings */
      var binary = "", i;
      var rStr = "", tempStr = [];
  
      for (i=1; ((i<10) && (i<evoLen+2)); i++) {
        if ((getComputedStyle(document.getElementById("evoLimits["+i+"]"), null).display == "inline-block") && (document.getElementById('evoCB['+i+']').checked)) {
          if (document.getElementById('league').value == "All") {tempStr = [];
            if (getComputedStyle(document.getElementById("GLlimit["+i+"]"), null).display == "inline-block") {tempStr.push(document.getElementById("GLlimit["+i+"]").value/1);}
            if (getComputedStyle(document.getElementById("ULlimit["+i+"]"), null).display == "inline-block") {tempStr.push(document.getElementById("ULlimit["+i+"]").value/1);}
            if (getComputedStyle(document.getElementById("MLlimit["+i+"]"), null).display == "inline-block") {tempStr.push(document.getElementById("MLlimit["+i+"]").value/1);}
            if (tempStr.length > 0) {
              for (j=0; j<tempStr.length; j++) {
                if (j===0) {rStr += "_"+tempStr[j];}
                else {rStr += "-" + tempStr[j];}
              }
            } else {rStr += "_f";}
          } else {
            if (((document.getElementById('league').value == "1500") || (document.getElementById('league').value == "500")) && (getComputedStyle(document.getElementById("GLlimit["+i+"]"), null).display == "inline-block")) {rStr += "_" + document.getElementById("GLlimit["+i+"]").value/1;}
            if ((document.getElementById('league').value == "2500") && (getComputedStyle(document.getElementById("ULlimit["+i+"]"), null).display == "inline-block")) {rStr += "_" + document.getElementById("ULlimit["+i+"]").value/1;}
            if ((document.getElementById('league').value === false) && (getComputedStyle(document.getElementById("MLlimit["+i+"]"), null).display == "inline-block")) {rStr += "_" + document.getElementById("MLlimit["+i+"]").value/1;}
          }
        } else {
          rStr += "_f";
        }
        if ((i==1) && (rStr.charAt(0)) == "_") {rStr = rStr.substring(1);} /* remove leading "_" */
      }
  
      binary = document.getElementById('trash').checked ? "1" : "0";
      binary += document.getElementById('onlyZero').checked ? "1" : "0";
      binary += document.getElementById('trashHundo').checked ? "1" : "0";
      binary += document.getElementById('trashZero').checked ? "1" : "0";
      binary += document.getElementById('base').checked ? "1" : "0";
      binary += document.getElementById('baby').checked ? "1" : "0";
      binary += document.getElementById('allZero').checked ? "1" : "0";
      binary += document.getElementById('customIVs').checked ? "1" : "0";
      
      console.log("encodeSettings: Computed binary as "+binary);
      
      return [binary,rStr];
    }
    
    function updateURI(selected,league,leagueName,lang,evoLen)
    {
      /* build binary encoding of settings for URL output */
      const [binary, rStr] = encodeSettings(evoLen);
      
      if (document.getElementById('allZero').checked) {
        /* Override CP Limit for allZero mode */
        league = document.getElementById('cpLimit').value;
        /* Piggyback dex skips onto lang field */
        lang = lang + "&skips="+document.getElementById('dexSkips').value;
      }
      
      if (document.getElementById('customIVs').checked) {
        /* Piggyback IVentry onto lang field */
        lang = lang + "&IVentry="+document.getElementById('IVentry').value;
      }
      
      /* update the URL with search parameters */
      var uri = window.location.href.split("?")[0];
      uri = encodeURI(uri + "?mon="+selected+"&cp="+league+"&r="+rStr+"&set="+binary+"&l="+lang+"&m="+maxLvl+"&s="+searchLvl);

      /* conditional for All Zero mode */
      if (!selected) {
        var newTitle = "PvP IVs - All Zero 0% Search String (cp<"+league+")";
      } else {
        var newTitle = "PvP IVs - "+selected+" "+leagueName+" Search String";
      }
      document.title = newTitle;
      window.history.pushState(null, newTitle, uri);
      /* Update canonical link to include mon & league for improved SEO */
      document.querySelector("link[rel='canonical']").setAttribute("href", "https://pvpivs.com/searchStr.html?mon="+selected+"&cp="+league+"&l="+lang);
      return;
    }
    
    /* leaner version of existing function which just spits out CPs + HPs for allZero String
     * Formatting Goal: (https://www.reddit.com/r/TheSilphRoad/comments/hm4t6u/mass_transfer_search_string/fx4oeyw/?context=1)
        
        213,129&0*
        
        &!213,cp10,cp14,cp20,cp26,cp32,cp38,cp43,cp49,cp55,cp61,cp66,cp72,cp77,cp83,cp89,cp94,cp100,cp105,cp111,cp116,cp122,cp128,cp133,cp139,cp144,cp150,cp155,cp161,cp166
        &!213,hp10,hp14,hp18,hp21,hp24,hp27,hp29,hp31,hp33,hp35,hp37,hp39-40,hp42-43,hp45-46,hp48-50,hp52-57,hp59-62
                  
        &!129,cp10-11,cp16,cp20,cp25,cp30,cp34,cp39,cp44,cp48,cp52,cp57,cp61,cp65,cp70,cp74,cp79,cp83,cp87,cp92,cp96,cp101,cp105,cp109,cp114,cp118,cp123,cp127,cp131
        &!129,hp10,hp14,hp18,hp21,hp24,hp27,hp29,hp31,hp33,hp35,hp37,hp39-40,hp42-43,hp45-46,hp48-50,hp52-57,hp59-62
        
      */
    function findAllZeros(cpLimit, dexSkips) {
      if (true) {var findAllZerosT0 = performance.now();}
      
      var lang = document.getElementById('lang').value.split(',');
      var output = document.getElementById('output');
      output.value = ''; /* ensure old output is cleared */
      var segments = '';
      var ids = '';
      console.log("fAZ:: cpLimit: "+cpLimit+", dexSkips: "+JSON.stringify(dexSkips));
      
      var message = "This string ignores PvP rankings, and only potential 0% IV (0/0/0) mon. For PvP rankings please uncheck 'Find ALL 0% mon' (below)";
      document.getElementById('feedbackBox').innerHTML = "<p><i>"+message+"</i></p>";

      for (var i=0; i<pokeList.length; i++) {
        
        /* Skip placeholder entries */
        if (pokeList[i].label.includes("_PLACEHOLDER")) {
          console.log("Skipped Placeholder mon: "+pokeList[i].label);
          continue;
        }
        
        /* Skip placeholder entries */
        if (pokeList[i].label.includes("_SPECULATIVE")) {
          console.log("Skipped Speculative mon: "+pokeList[i].label);
          continue;
        }
        
        /* Strip out the dex information */
        var dex = (pokeList[i].value.split(",")[0]);
        /* Remove b from dex info but preserve the rest for proper output */
        if (dex.includes("b")) {
          dex = dex.split("b")[0] + dex.split("b")[1];
        }
        
        /* Ensure it can spawn in the wild */
        if (dex.includes("&mega")) {
          console.log("Skipped Mega Evo #"+dex+"("+pokeList[i].label+")");
          continue;
        }
        
        /* Strip out "&" info and convert dex to numerical id */
        id = dex.split("&")[0]/1;
        
        /* Check for dex numbers that user wants to skip */
        if (dexSkips.includes(id/1)) {
          console.log("User asked to skip #"+id+"("+pokeList[i].label+"), Skipping!");
          continue;
        }
        
        var cps = [], hps = [], results;
        var maxCP = new Array(5).fill(0), maxHP = new Array(5).fill(0);
        var monStats = pokeList[i].value.split(',');
        cps[0] = new Set();
        hps[0] = new Set();
    
        
        results = getZeroCPs(parseInt(monStats[1]), parseInt(monStats[2]), parseInt(monStats[3]), maxCP, maxHP, cps[0], hps[0]);
        cps[0] = results[0];
        hps[0] = results[1];
        
        /* Skip forms above CP limit which aren't common wild spawns */
        if (results[2][0]/1 > cpLimit/1) {
          console.log("Skipped #"+id+"("+pokeList[i].label+"), over maxCP("+results[2][0]/1+")");
          continue;
        }
        segments += outputZeroCPsHPs(cps.slice(), hps.slice(), dex, lang);
        ids += dex+',';
      }
      /* trim trailing ',' */
      ids = ids.replace(/,\s*$/, "");
      output.value = ids+"&0*"+segments;
        document.getElementById('feedbackBox').innerHTML += "<p><i>Output Search String Length: "+output.value.length.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",")+" characters</i></p>";
      
      if (perfTiming) {var findAllZerosT1 = performance.now();
      console.log("findAllZeros: Execution took "+(findAllZerosT1-findAllZerosT0).toFixed(1)+"ms");}
      
      return;
    }
    
    function outputZeroCPsHPs(cps, hps, id, lang) {
      if (perfTiming) {var outputZeroCPsHPsT0 = performance.now();}
        
      /* skip empty sets */
      if (cps[0].size > 0) {
        
        /* output CPs */
        cps[0] = Array.from(cps[0]);
        cps[0].sort((a, b) => a - b);
        var segment = '&!'+id+',' + get_matching_string(cps[0], lang[1]);
        
        /* skip empty hps */
        if (hps[0].size > 0) {
          hps[0] = Array.from(hps[0]);
          hps[0].sort((a, b) => a - b);
          segment += '&!'+id+',' + get_matching_string(hps[0], lang[2]);
        }
        /* Ensure additional regional search terms are translated as needed*/
        if (lang[0] !== "en")
        {
          /* lang : cpstr,  hpstr,  mega,   alola,  eggsonly, galar,  ground, steel,  grass,  psychic, fire */
          /* lang : lang[1],lang[2],lang[3],lang[4],lang[5],  lang[6],lang[7],lang[8],lang[9],lang[10],lang[11] */
          /* Wormadam Grass/Ground/Steel, Lucario eggsonly/!mega, Darmanitan Galar/Fire/Psychic, Rattata Alola */
          output.value = output.value.replace(/mega/gi,    lang[3]);
          output.value = output.value.replace(/alola/gi,   lang[4]);
          output.value = output.value.replace(/eggsonly/gi,lang[5]);
          output.value = output.value.replace(/galar/gi,   lang[6]);
          output.value = output.value.replace(/ground/gi,  lang[7]);
          output.value = output.value.replace(/steel/gi,   lang[8]);
          output.value = output.value.replace(/grass/gi,   lang[9]);
          output.value = output.value.replace(/psychic/gi, lang[10]);
          output.value = output.value.replace(/fire/gi,    lang[11]);
        }
      }
      if (perfTiming) {var outputZeroCPsHPsT1 = performance.now();
      console.log("outputZeroCPsHPs: Execution took "+(outputZeroCPsHPsT1-outputZeroCPsHPsT0).toFixed(1)+"ms");}
      return segment;
    }
    
    function getRanks(evoVals, trash, trashHundo, trashZero, onlyZero, league, maxLvl) {
      if (perfTiming) {var getRanksT0 = performance.now();}
      console.log("gR::Received evoVals:"+JSON.stringify(evoVals));
      
      var message = "String ", numRanks = 0, rKeys, GLkeys, ULkeys, MLkeys, i, j, leagueLim;
      var GLranks = {}, ULranks = {}, MLranks = {}, finalRanks = {};

      for (i=0; i<evoVals.length; i++) {
        if (evoVals[i][0]){console.log("Loop #"+i+": evoVals["+i+"]:"+JSON.stringify(evoVals[i]));}
        if (league != "All") {
          switch(league) {
            case "500":
              leagueLim = evoVals[i][6]/1;
              break;
            case "1500":
              leagueLim = evoVals[i][6]/1;
              break;
            case "2500":
              leagueLim = evoVals[i][7]/1;
              break;
            default:
              leagueLim = evoVals[i][8]/1;
          }
        }
        else { /* league == "All" */
          leagueLim = evoVals[i][6]/1;
        }
        switch(i) {
          
          case 0: /* base mon */
            if ((trash) && (!onlyZero)) {
              message += "trashes all "+evoVals[i][4]+" except ";
              if (!trashHundo) {message += "perfect IV (15/15/15) and ";}
              if (!trashZero) {message += "zero IV (0/0/0) and ";}
            } else {message += "finds "+evoVals[i][4]+" as ";}
          break;
  
          default: /* all evos */
            if (evoVals[i][0]) {
              if ((league != "All") && (league > 500)) {
                GLranks = calculate(parseInt(evoVals[i][1]), parseInt(evoVals[i][2]), parseInt(evoVals[i][3]), document.getElementById('floor').value, 0, maxLvl, false, league, evoVals[i][4]);
                message += " and Top "+leagueLim/1+ " PvP "+evoVals[i][4];
                rKeys = Object.keys(GLranks);
                for (j=leagueLim/1; j<rKeys.length; j++) {delete GLranks[rKeys[j]];}
                finalRanks = {...finalRanks, ...GLranks};
                numRanks += leagueLim/1;
              } else {
                
                if (evoVals[i][6]/1 > 0) { /* Be sure the user wants this league before building anything! */
                  /* Run Great League Calculations first, always need to be done for all Leagues */
                  GLranks = calculate(parseInt(evoVals[i][1]), parseInt(evoVals[i][2]), parseInt(evoVals[i][3]), document.getElementById('floor').value, 0, maxLvl, false, 1500, evoVals[i][4]);
                  message += ",<br> and PvP "+evoVals[i][4]+" for Top "+evoVals[i][6];
                  if (league > 500) {message += " GL";}
                  GLkeys = Object.keys(GLranks);
                  for (j=evoVals[i][6]/1; j<GLkeys.length; j++) {delete GLranks[GLkeys[j]];}
                  numRanks += evoVals[i][6]/1;
                }
    
                if ((evoVals.length<2) || ((evoVals[i][5]/1 > 1500) && (evoVals[i][7]/1 > 0))) {
                  ULranks = calculate(parseInt(evoVals[i][1]), parseInt(evoVals[i][2]), parseInt(evoVals[i][3]), document.getElementById('floor').value, 0, maxLvl, false, 2500, evoVals[i][4]);
                  message += ", and Top "+evoVals[i][7]+ " UL";
                  ULkeys = Object.keys(ULranks);
                  for (j=evoVals[i][7]/1; j<ULkeys.length; j++) {delete ULranks[ULkeys[j]];}
                  numRanks += evoVals[i][7]/1;
                }
                
                if ((evoVals.length<2) || ((evoVals[i][5]/1 > 2500) && (evoVals[i][8]/1 > 0))) {
                  MLranks = calculate(parseInt(evoVals[i][1]), parseInt(evoVals[i][2]), parseInt(evoVals[i][3]), document.getElementById('floor').value, 0, maxLvl, false, false, evoVals[i][4]);
                  message += ", and Top "+evoVals[i][8]+ " ML";
                  MLkeys = Object.keys(MLranks);
                  for (j=evoVals[i][8]/1; j<MLkeys.length; j++) {delete MLranks[MLkeys[j]];}
                  numRanks += evoVals[i][8]/1;
                }
                finalRanks = {...finalRanks, ...GLranks, ...ULranks, ...MLranks};
              }
            } else {console.log("default: skipping i="+i+": "+JSON.stringify(evoVals[i])+"...");}
            break;
        }
      }
      if (league == "500") {message += " Little League";}
      else if (league == "1500") {message += " for Great League";}
      else if (league == "2500") {message += " for Ultra League";}
      else if (league != "All") {message += " for Master League";}
      /* Fix "as and Top", "as ,<br> and PvP", "and ,<br> and" message grammar errors */
      message = message.replace("as  and Top", "as Top");
      message = message.replace("as ,<br> and PvP", "as PvP");
      message = message.replace(" and ,<br> and PvP", ",<br>and PvP");
      document.getElementById('outputSummaryBox').innerHTML = "<p>"+message+"</p>";
      if (perfTiming) {var getRanksT1 = performance.now();
      console.log("getRanks: Execution took "+(getRanksT1-getRanksT0).toFixed(1)+"ms");}
      return finalRanks;
    }
    
    /* Given valid family stats in evoVals, outputs a Search String for the user */
    function outputStr(evoVals, trash, trashHundo, trashZero, onlyZero, league, output, lang, maxLvl) {
      if (perfTiming) {var outputStrT0 = performance.now();}
  
      /* create our rank object to compute cps/hps from for output string */
      const mergedRanks = getRanks(evoVals, trash, trashHundo, trashZero, onlyZero, league, maxLvl);
  
      var rKeys = Object.keys(mergedRanks), message;
      output.value = ''; /* ensure old output is cleared */
      var cps = [], hps = [], results, i, j, k;
      cps[0] = new Set();
      hps[0] = new Set();
      cps[1] = new Set();
      hps[1] = new Set();
      cps[2] = new Set();
      hps[2] = new Set();
      cps[3] = new Set();
      hps[3] = new Set();
      cps[4] = new Set();
      hps[4] = new Set();
      var maxCP = new Array(5).fill(0), maxHP = new Array(5).fill(0);
      var searchLvl = document.getElementById('searchLvl').value.split(",").map(x=>+x);
      var maxSearchLvl = 0;
  
      if (onlyZero) {
        if (trash) {
          message = "This string only finds 0% IVs, and is NOT a trash string. Please uncheck 'Trash String' (below)";
        document.getElementById('feedbackBox').innerHTML = "<p><i>"+message+"</i></p>";
        } else {
          message = "This string ignores PvP rankings. For PvP rankings please uncheck 'Only Find 0% IVs' (below)";
          document.getElementById('feedbackBox').innerHTML = "<p><i>"+message+"</i></p>";
        }
        results = getZeroCPs(evoVals[0][1], evoVals[0][2], evoVals[0][3], maxCP, maxHP, cps[0], hps[0]);
        cps[0] = results[0];
        hps[0] = results[1];
        maxCP = results[2];
        maxHP = results[3];
        outputCPsHPsBuckets(cps.slice(), maxCP, hps.slice(), maxHP, output, evoVals[0][0], lang, trash, trashHundo, onlyZero);
        message = "String finds only potential 0% IV (0/0/0) "+evoVals[0][4]+", not PvP ranks";
        document.getElementById('outputSummaryBox').innerHTML = "<p>"+message+"</p>";
        return output;
      } else {
        if ((!trashZero) && (trash)) {
          results = getZeroCPs(evoVals[0][1], evoVals[0][2], evoVals[0][3], maxCP, maxHP, cps[0], hps[0]);
          cps[0] = results[0];
          hps[0] = results[1];
          maxCP = results[2];
          maxHP = results[3];
        }
        
        /* generate all the cps and hps for matching */
        /* for ranks 1 to user cutoff, up to maxSearchLvl/league limit */
        for (i=0; i<rKeys.length; i++) {
          for (j=0; j<mergedRanks[rKeys[i]].length; j++) {
            
            /** Compare the max PvP level for this evo
              * (mergedRanks[rKeys[i]][j].L) to levels
              * selected by the user to search for
              * (searchLvl[k]) to ensure that we don't
              * output CPs/HPs that are too high of a
              * level for the requested final PvP mon
              */
            for (k=0; k<searchLvl.length; k++)
            {
              if (mergedRanks[rKeys[i]][j].L < searchLvl[k])
              {
                /* Need to skip these levels when outputting, they're too high for PvP */
                /*console.log("mergedRanks[rKeys["+i+"]]["+j+"].L("+mergedRanks[rKeys[i]][j].L+") < ("+searchLvl[k]+")searchLvl["+k+"], skipping L"+searchLvl[k]+" in final Search String");*/
              }
              else
              {
                /* We either found or skipped over the level we needed to start at, exit loop */
                /*console.log("mergedRanks[rKeys["+i+"]]["+j+"].L("+mergedRanks[rKeys[i]][j].L+") >= ("+searchLvl[k]+")searchLvl["+k+"], stopping search! Starting output at L"+searchLvl[k]+" in final Search String");*/
                maxSearchLvl = k;
                break;
              }
            }
      
            /* Generate CPs and HPs to search for up to maxSearchLvl cutoff */
            for(k=maxSearchLvl; k<searchLvl.length; k++) {
              lookupLvl = (searchLvl[k]-1)*2;
              var cp = Math.max(10, Math.floor((evoVals[0][1]/1 + mergedRanks[rKeys[i]][j].IVs.A) * Math.sqrt(evoVals[0][2]/1 + mergedRanks[rKeys[i]][j].IVs.D) * Math.sqrt(evoVals[0][3]/1 + mergedRanks[rKeys[i]][j].IVs.S) * cpm[lookupLvl] * cpm[lookupLvl] / 10));
              /*console.log("Generated cp("+cp+") at lookupLvl("+lookupLvl+"), searchLvl["+k+"]:"+searchLvl[k]);*/
              
              /* generate hps for more accurate search string matching */
              var hp = Math.max(10, Math.floor((evoVals[0][3]/1 + mergedRanks[rKeys[i]][j].IVs.S) * cpm[lookupLvl]));
              
              /* bucket CPs and HPs into appraisal ratings for more accurrate matching */
              switch (mergedRanks[rKeys[i]][j].IVs.star) {
                case "0*":
                  cps[0].add(cp);
                  hps[0].add(hp);
                  if (maxCP[0] < cp) {maxCP[0] = cp;}
                  if (maxHP[0] < hp) {maxHP[0] = hp;}
                  break;
                case "1*":
                  cps[1].add(cp);
                  hps[1].add(hp);
                  if (maxCP[1] < cp) {maxCP[1] = cp;}
                  if (maxHP[1] < hp) {maxHP[1] = hp;}
                  break;
                case "2*":
                  cps[2].add(cp);
                  hps[2].add(hp);
                  if (maxCP[2] < cp) {maxCP[2] = cp;}
                  if (maxHP[2] < hp) {maxHP[2] = hp;}
                  break;
                case "3*":
                  cps[3].add(cp);
                  hps[3].add(hp);
                  if (maxCP[3] < cp) {maxCP[3] = cp;}
                  if (maxHP[3] < hp) {maxHP[3] = hp;}
                  break;
                case "4*":
                  cps[4].add(cp);
                  hps[4].add(hp);
                  if (maxCP[4] < cp) {maxCP[4] = cp;}
                  if (maxHP[4] < hp) {maxHP[4] = hp;}
                  break;
              }
            }
          }
        }
      }
      
      /* get actual maxCP and maxHP using spread syntax */
      if ((league == "All") && (trash)) {
        maxCP.fill(Math.max(...maxCP));
        maxHP.fill(Math.max(...maxHP));
      }
        
      /* output the CPs and HPs */
      outputCPsHPsBuckets(cps.slice(), maxCP, hps.slice(), maxHP, output, evoVals[0][0], lang, trash, trashHundo, onlyZero);
      var origOut = output.value;
      
      if (origOut.length > 2000) { /* Check and split output length into <2000 char chunks at commas for iOS users */
        let excessOut = output.value.substring(0); /* ensure we don't mutilate actual output */
        let div = document.getElementById("overflowArea"); /* div where overflows are created */
        div.innerHTML = "<i style='font-size:0.6em'>&lt;2000 character strings for iOS Text Replacement compatibility:</i><br />";
        for (i=1;excessOut.length>0;i++) {
          let newOverflow = document.createElement("textarea");
          newOverflow.id = "overflow"+i; newOverflow.rows=1; newOverflow.style="width: 50%; height: 50%;"; newOverflow.setAttribute('onclick', "autocopy(this)"); div.appendChild(newOverflow);
          let cut = excessOut.slice(0, 2001).lastIndexOf(",")+1; /*correct for 0 index with + 1*/
          document.getElementById("overflow"+i).value = (excessOut.length>2000) ? excessOut.slice(0, cut) : excessOut;
          console.log("TotalLen:"+origOut.length+", cut:"+cut+", excessOut.length:"+excessOut.length);
          excessOut = (excessOut.length>2000) ? excessOut.substring(cut) : 0;
        }
      }
      
      if (evoVals[0][4] == "Burmy") {
        if (finalVals[4] == "Mothim") {
          console.log("Found Mothim!");
          output.value += "&male";
        } else if (finalVals[4].indexOf("Wormadam") > -1 ) {
          console.log("Found:"+evoVals[0][4]);
          output.value += "&female";
        }
      }
      
      if (perfTiming) {var outputStrT1 = performance.now();
      console.log("outputStr: Execution took "+(outputStrT1-outputStrT0).toFixed(1)+"ms");}
      return output;
    }
    
    /* Given custom IVs customIVs, outputs a Search String for the user */
    function outputCustomIVsStr(customIVs, baseAtk, baseDef, baseSta, finalEvoAtk, finalEvoDef, finalEvoSta, league, output, lang, maxLvl, dexNum, monName) {
      if (perfTiming) {var outputCustomIVsStrT0 = performance.now();}
      
      /*console.log("Received customIVs: "+JSON.stringify(customIVs)+", baseAtk: "+baseAtk+", baseDef:"+baseDef+", baseSta:"+baseSta+", league:"+league+", output:"+output+", maxLvl:"+maxLvl+", dexNum:"+dexNum+", monName:"+monName);*/
  
      output.value = ''; /* ensure old output is cleared */
      var cps = [], hps = [], results, i, j, k;
      cps[0] = new Set();
      hps[0] = new Set();
      cps[1] = new Set();
      hps[1] = new Set();
      cps[2] = new Set();
      hps[2] = new Set();
      cps[3] = new Set();
      hps[3] = new Set();
      cps[4] = new Set();
      hps[4] = new Set();
      var maxCP = new Array(5).fill(0), maxHP = new Array(5).fill(0);
      /* Reverse searchLvl so we start at L0 and generate string up to League CP cutoff */
      var searchLvl = document.getElementById('searchLvl').value.split(",").map(x=>+x).reverse();
      
      /* generate all the cps and hps for matching */
      /* for all customIV spreads, up to league CP limit */
      for (i=0; i<customIVs.length; i++) {
        for (k=0; k<searchLvl.length; k++) {
          lookupLvl = (searchLvl[k]-1)*2;
          
          var cp = Math.max(10, Math.floor((baseAtk/1 + customIVs[i].A/1) * Math.sqrt(baseDef/1 + customIVs[i].D/1) * Math.sqrt(baseSta/1 + customIVs[i].S/1) * cpm[lookupLvl] * cpm[lookupLvl] / 10));
          var finalEvoCP = Math.max(10, Math.floor((finalEvoAtk/1 + customIVs[i].A/1) * Math.sqrt(finalEvoDef/1 + customIVs[i].D/1) * Math.sqrt(finalEvoSta/1 + customIVs[i].S/1) * cpm[lookupLvl] * cpm[lookupLvl] / 10));
          
          /* Check if this level+IVs combo is over league CP cap*/
          if (finalEvoCP/1 > league/1) {
            console.log(customIVs[i]+" at L:"+lookupLvl+" finalEvoCP:"+finalEvoCP+" is over league limit ("+league+", finished with this IV set");
            break;
          }
          /* generate hps for more accurate search string matching */
          var hp = Math.max(10, Math.floor((baseSta/1 + customIVs[i].S/1) * cpm[lookupLvl]));
          
          /* bucket CPs and HPs into appraisal ratings for more accurrate matching */
          var IVsum = customIVs[i].A/1 + customIVs[i].D/1 + customIVs[i].S/1;
    		  var Star = "NA";
          if (IVsum<23){Star="0*";}else if(IVsum<30){Star="1*";}else if (IVsum<37){Star="2*";}else if(IVsum<45){Star="3*";}else{Star="4*";}
          switch (Star) {
            case "0*":
              cps[0].add(cp);
              hps[0].add(hp);
              if (maxCP[0] < cp) {maxCP[0] = cp;}
              if (maxHP[0] < hp) {maxHP[0] = hp;}
              break;
            case "1*":
              cps[1].add(cp);
              hps[1].add(hp);
              if (maxCP[1] < cp) {maxCP[1] = cp;}
              if (maxHP[1] < hp) {maxHP[1] = hp;}
              break;
            case "2*":
              cps[2].add(cp);
              hps[2].add(hp);
              if (maxCP[2] < cp) {maxCP[2] = cp;}
              if (maxHP[2] < hp) {maxHP[2] = hp;}
              break;
            case "3*":
              cps[3].add(cp);
              hps[3].add(hp);
              if (maxCP[3] < cp) {maxCP[3] = cp;}
              if (maxHP[3] < hp) {maxHP[3] = hp;}
              break;
            case "4*":
              cps[4].add(cp);
              hps[4].add(hp);
              if (maxCP[4] < cp) {maxCP[4] = cp;}
              if (maxHP[4] < hp) {maxHP[4] = hp;}
              break;
          }
        }
      }
        
      /* output the CPs and HPs */
      outputCPsHPsBuckets(cps.slice(), false, hps.slice(), false, output, dexNum, lang, false, true, false);
      var origOut = output.value;
      
      if (origOut.length > 2000) { /* Check and split output length into <2000 char chunks at commas for iOS users */
        let excessOut = output.value.substring(0); /* ensure we don't mutilate actual output */
        let div = document.getElementById("overflowArea"); /* div where overflows are created */
        div.innerHTML = "<i style='font-size:0.6em'>&lt;2000 character strings for iOS Text Replacement compatibility:</i><br />";
        for (i=1;excessOut.length>0;i++) {
          let newOverflow = document.createElement("textarea");
          newOverflow.id = "overflow"+i; newOverflow.rows=1; newOverflow.style="width: 50%; height: 50%;"; newOverflow.setAttribute('onclick', "autocopy(this)"); div.appendChild(newOverflow);
          let cut = excessOut.slice(0, 2001).lastIndexOf(",")+1; /*correct for 0 index with + 1*/
          document.getElementById("overflow"+i).value = (excessOut.length>2000) ? excessOut.slice(0, cut) : excessOut;
          console.log("TotalLen:"+origOut.length+", cut:"+cut+", excessOut.length:"+excessOut.length);
          excessOut = (excessOut.length>2000) ? excessOut.substring(cut) : 0;
        }
      }
      
      if (monName == "Burmy") {
        if (finalVals[4] == "Mothim") {
          console.log("Found Mothim!");
          output.value += "&male";
        } else if (finalVals[4].indexOf("Wormadam") > -1 ) {
          console.log("Found:"+monName);
          output.value += "&female";
        }
      }
      
      if (perfTiming) {var outputStrT1 = performance.now();
      console.log("outputStr: Execution took "+(outputStrT1-outputStrT0).toFixed(1)+"ms");}
      return output;
    }
    
    function outputCPsHPsBuckets(cps, maxCP, hps, maxHP, output, id, lang, trash, trashHundo, onlyZero) {
      if (perfTiming) {var outputCPsHPsBucketsT0 = performance.now();}
      
      var emptyBuf = "";
      output.value = id; /* add dex num */
      var maxLoops = 5;/* Even for onlyZero=true need all 5 appraisals */
      
      /* output cps and hps */
      for (var i=0; i<maxLoops; i++) {
        if (i == 4) { /* handle 4* case */
          if ((trash) && (!trashHundo)) {
            emptyBuf += '&!'+i+'*';
            continue;
          } else if (cps[4].size > 0) {
            if (!trash) {emptyBuf += ',4*';continue;}
          }
        }
        /* skip empty sets */
        if (cps[i].size > 0) {
          /* only flip CPs/HPs if non-zero */
          if ((trash) && (!onlyZero)) {
            cps[i] = trashFlip(cps[i], maxCP[i]);
            
            /* skip empty hps */
            if (hps[i].size > 0) {
              hps[i] = trashFlip(hps[i], maxHP[i]);
            }
          }
          
          /* output CPs */
          cps[i] = Array.from(cps[i]);
          cps[i].sort((a, b) => a - b);
          output.value += '&!'+i+'*,' + get_matching_string(cps[i], lang[1]);
          
          if ((!trash) || (onlyZero)) {
            output.value += '&!'+i+'*';
          }
          
          /* skip empty hps */
          if (hps[i].size > 0) {
            hps[i] = Array.from(hps[i]);
            hps[i].sort((a, b) => a - b);
            output.value += ',' + get_matching_string(hps[i], lang[2]);
          }
        } else if ((!trash) || (onlyZero)) { /* skip empty appraisal sets in search string */
          emptyBuf += '&!'+i+'*';
        }

      }
      output.value += emptyBuf; /* add trash stuff */
      
      /* Ensure additional regional search terms are translated as needed*/
      if (lang[0] !== "en")
      {
        /* lang : cpstr,  hpstr,  mega,   alola,  eggsonly, galar,  ground, steel,  grass,  psychic, fire */
        /* lang : lang[1],lang[2],lang[3],lang[4],lang[5],  lang[6],lang[7],lang[8],lang[9],lang[10],lang[11] */
        /* Wormadam Grass/Ground/Steel, Lucario eggsonly/!mega, Darmanitan Galar/Fire/Psychic, Rattata Alola */
        output.value = output.value.replace(/mega/gi,    lang[3]);
        output.value = output.value.replace(/alola/gi,   lang[4]);
        output.value = output.value.replace(/eggsonly/gi,lang[5]);
        output.value = output.value.replace(/galar/gi,   lang[6]);
        output.value = output.value.replace(/ground/gi,  lang[7]);
        output.value = output.value.replace(/steel/gi,   lang[8]);
        output.value = output.value.replace(/grass/gi,   lang[9]);
        output.value = output.value.replace(/psychic/gi, lang[10]);
        output.value = output.value.replace(/fire/gi,    lang[11]);
      }
      
      if (perfTiming) {var outputCPsHPsBucketsT1 = performance.now();
      console.log("outputCPsHPsBuckets: Execution took "+(outputCPsHPsBucketsT1-outputCPsHPsBucketsT0).toFixed(1)+"ms");}
      return true;
    }
    
    function getZeroCPs(baseatk, basedef, basesta, maxCP, maxHP, cps, hps) {
      if (perfTiming) {var getZeroCPsT0 = performance.now();}
  
      /* generate all the cps and hps for matching */
      var maxLvl = (30 - 1)*2; /* highest level possible without IV boost (L30) */
  
      /* skip half level CPs in search strings to improve accuracy */
      for( var level = maxLvl; level >= 0; level = level - 2 ) {
        var cp = Math.max(10, Math.floor((baseatk/1 + 0) * Math.sqrt(basedef/1 + 0) * Math.sqrt(basesta/1 + 0) * cpm[level] * cpm[level] / 10));
  
        /* generate hps for more accurate search string matching */
        var hp = Math.max(10, Math.floor((basesta/1 + 0) * cpm[level]));
  
        /* update counters for maxCP and maxHP */
        if (maxCP[0] < cp) {maxCP[0] = cp;}
        if (maxHP[0] < hp) {maxHP[0] = hp;}
        cps.add(cp);
        hps.add(hp);
      }
      if (perfTiming) {var getZeroCPsT1 = performance.now();
      console.log("getZeroCPs: Execution took "+(getZeroCPsT1-getZeroCPsT0).toFixed(1)+"ms");}
      return [cps, hps, maxCP, maxHP];
    }
    
    function getCustomCPs(baseatk, basedef, basesta, maxCP, maxHP, aIV, dIV, sIV, cps, hps) {
      if (perfTiming) {var getCustomCPsT0 = performance.now();}
  
      /* generate all the cps and hps for matching */
      var maxLvl = (30 - 1)*2; /* highest level possible without IV boost (L30) */
  
      /* skip half level CPs in search strings to improve accuracy */
      for( var level = maxLvl; level >= 0; level = level - 2 ) {
        var cp = Math.max(10, Math.floor((baseatk/1 + aIV/1) * Math.sqrt(basedef/1 + dIV/1) * Math.sqrt(basesta/1 + sIV/1) * cpm[level] * cpm[level] / 10));
  
        /* generate hps for more accurate search string matching */
        var hp = Math.max(10, Math.floor((basesta/1 + sIV/1) * cpm[level]));
  
        /* update counters for maxCP and maxHP */
        if (maxCP[0] < cp) {maxCP[0] = cp;}
        if (maxHP[0] < hp) {maxHP[0] = hp;}
        cps.add(cp);
        hps.add(hp);
      }
      if (perfTiming) {var getCustomCPsT1 = performance.now();
      console.log("getCustomCPs: Execution took "+(getCustomCPsT1-getCustomCPsT0).toFixed(1)+"ms");}
      return [cps, hps, maxCP, maxHP];
    }
    
    function trashFlip(cps, maxCP) {
      if (perfTiming) {var trashFlipT0 = performance.now();}
      if (cps instanceof Set) {
        for (var i=10; i<=maxCP; i++) {
          if( cps.has(i) ) {
    				cps.delete(i);
    			} else {
    				cps.add(i);
    		  }
        }
        if (perfTiming) {var trashFlipT1 = performance.now();
        console.log("trashFlip: Execution took "+(trashFlipT1-trashFlipT0).toFixed(1)+"ms");}
        return cps;
      } else {
        console.log("trashFlip: ERROR: received cps as "+typeof cps+" instead of expected set");
        document.getElementById('errorBox').innerHTML = "ERROR: Please try again. If this persists, please send us your Search's URL via <a href='https://discord.gg/UD4Temq'>Discord!</a>";
        if (perfTiming) {var trashFlipT1 = performance.now();
        console.log("trashFlip: Execution took "+(trashFlipT1-trashFlipT0).toFixed(1)+"ms");}
        return false;
      }
    }
    
    /* Only accepts a SORTED array of numbers to output */
    function get_matching_string(a, t) {
      if (perfTiming) {var get_matching_stringT0 = performance.now();}
      var list = '', last = -1;
      
    	for( var i = 0; i < a.length; i++ ) {
    		if( a[i] == last + 1 ) {
    			list += '-';
    			last = a[i];
    			while( ++i < a.length ) {
    				if( a[i] != last + 1 ) break;
    				last = a[i];
    			}
    			if( a[--i] < 9999 ) {
    				list += a[i];
    			}
    		} else {
    			list += ',' + t + a[i];
    			last = a[i];
    		}
    	}
    	
    	if (perfTiming) {var get_matching_stringT1 = performance.now();
      console.log("get_matching_string: Execution took "+(get_matching_stringT1-get_matching_stringT0).toFixed(1)+"ms");}
    	return list.substr(1);
    }
    
    function autocopy(e) {
      if (perfTiming) {var autocopyT0 = performance.now();}
    	e.select();
    	document.execCommand('copy');
    	if (perfTiming) {var autocopyT1 = performance.now();
      console.log("autocopy: Execution took "+(autocopyT1-autocopyT0).toFixed(1)+"ms");}
      return true;
    }
    </script>
    <h3>Settings:</h3>
    <label>Trash String:<input id="trash" type="checkbox" oninput="main()"><br /></label>
    <div id="trashAdv" style="display: none;"><label>Trash Perfect IVs:<input id="trashHundo" type="checkbox" oninput="main()"></label><br />
    <label>Trash Zero IVs:<input id="trashZero" type="checkbox" checked oninput="main()"></label><br /></div>
    <label>Only Find 0% IVs:<input id="onlyZero" type="checkbox" oninput="main()"><br /></label>
    <label>Find ALL 0% mon:<input id="allZero" type="checkbox" oninput="main()"><br /></label>
    <div id="cpLimitDiv"><label id="cpLimitLbl" for="cpLimit" style="display: none;">CP Limit:</label><input type="number" id="cpLimit" oninput="main(true)" value="1500" style="display: none;"></div>
    <div id="dexSkipsDiv"><label id="dexSkipsLbl" for="dexSkips" style="display: none;">Dex Skips:</label><input id="dexSkips" oninput="main(true)" value="144,145,146,150,151,243,244,245,249,250,251,377,378,379,380,381,382,383,384,385,386,481,482,483,484,485,486,487,488,489,490,491,492,493,494,638,639,640,641,642,643,644,645,646,647,648,649,716,717,718,719,720,721,772,773,785,786,787,788,789,790,791,792,800,801,802,807,888,889,890,891,892,893,894,895,896,897,898" style="display: none;"></div>
    <div id="baseDiv"><label id="baseLbl" for="base" style="display: none;">Search for Base Evo:</label><input id="base" type="checkbox" checked oninput="main(true)" style="display: none;"></div>
    <div id="babyDiv"><label id="babyLbl" for="baby" style="display: none;">Search for Baby Evo:</label><input id="baby" type="checkbox" oninput="main(true)" style="display: none;"></div>
    <label>Custom IV Search:<input id="customIVs" type="checkbox" oninput="main()"><br /></label>
    <div id="IVentryDiv"> <label id="IVentryLbl" for="IVentry"  style="display: none;">Custom IVs:</label><input id="IVentry" oninput="main(true)" value="11/12/13,4-5-6 1+2+3" style="display: none;"></div>
    <label>Language:<select id="lang" oninput="main()">
    		<option value="en,cp,hp,mega,alola,eggsonly,galar,ground,steel,grass,psychic,fire">English</option>
    		<option value="fr,pc,pv,mega,alola,oeufseulement,galar,sol,acier,plante,psy,feu">French</option>
    		<option value="de,wp,kp,mega,alola,nurausEiern,galar,boden,stahl,pflanze,psycho,feuer">German</option>
    		<option value="es,pc,puntos de salud,mega,alola,huevosolo,galar,tierra,acero,planta,ps&#xed;quico,fuego">Spanish</option>
    		<option value="it,pl,punti salute,mega,dialola,solouovo,galar,terra,acciaio,erba,psico,fuoco">Italian</option>
    		<option value="ja,cp,hp,mega,&#x3042;&#x308d;&#x30fc;&#x3089;,&#x305f;&#x307e;&#x3054;&#x306e;&#x307f;,&#x30ac;&#x30e9;&#x30eb;,&#x3058;&#x3081;&#x3093;,&#x306f;&#x304c;&#x306d;,&#x304f;&#x3055;,&#x30a8;&#x30b9;&#x30d1;&#x30fc;,&#x307b;&#x306e;&#x304a;">Japanese</option>
    		<option value="ko,cp,hp,mega,&#xc54c;&#xb85c;&#xb77c;,&#xc54c;,&#xd558;&#xb098;,&#xb545;,&#xac15;&#xcca0;,&#xd480;,&#xc5d0;&#xc2a4;&#xd37c;,&#xbd88;&#xaf43;">Korean</option>
    		<option value="pt,pc,ps,mega,alola,apenasovos,galar,terrestre,A&#xe7;o,planta,Ps&#xed;quico,fogo">Portuguese</option>
    		<option value="zh,cp,hp,mega,&#x963f;&#x7f85;&#x62c9;,&#x53ea;&#x9650;&#x86cb;,&#x4f3d;&#xf952;&#x723e;,&#x5730;&#x9762;,&#x92fc;,&#x8349;,&#x8d85;&#x80fd;&#x529b;,&#x706b;">Chinese</option>
    </select>
    </label><br />
    <label>IV Floor:<select id="floor" oninput="main()">
        <option value="0">0: Wild Caught</option>
        <option value="1">1: Trade, Good Friend</option>
        <option value="2">2: Trade, Great / Purified</option>
        <option value="3">3: Trade, Ultra Friend</option>
        <option value="4">4: Weather Boost</option>
        <option value="5">5: Trade, Best Friend</option>
        <option value="6">6: Shadow Legendary</option>
        <option value="10">10: Raid / Hatch</option>
        <option value="12">12: Lucky Trade</option>
      </select></label><br />
    <div><label id="maxLvlLbl">Max PvP Level:</label><select title="What Level Ceiling to Search?" id="maxLvl" oninput="main()">
        <option value="1">1: Wild Caught</option>
        <option value="2">2</option>
        <option value="3">3</option>
        <option value="4">4</option>
        <option value="5">5</option>
        <option value="6">6</option>
        <option value="7">7</option>
        <option value="8">8</option>
        <option value="9">9</option>
        <option value="10">10</option>
        <option value="11">11</option>
        <option value="12">12</option>
        <option value="13">13</option>
        <option value="14">14</option>
        <option value="15">15: Research Reward</option>
        <option value="16">16</option>
        <option value="17">17</option>
        <option value="18">18</option>
        <option value="19">19</option>
        <option value="20">20: Raid Reward</option>
        <option value="21">21</option>
        <option value="22">22</option>
        <option value="23">23</option>
        <option value="24">24</option>
        <option value="25">25: Purified</option>
        <option value="26">26</option>
        <option value="27">27</option>
        <option value="28">28</option>
        <option value="29">29</option>
        <option value="30">30</option>
        <option value="31">31</option>
        <option value="32">32</option>
        <option value="33">33</option>
        <option value="34">34</option>
        <option value="35">35</option>
        <option value="36">36</option>
        <option value="37">37</option>
        <option value="38">38</option>
        <option value="39">39</option>
        <option selected value="40">40</option>
        <option value="41">41</option>
        <option value="42">42</option>
        <option value="43">43</option>
        <option value="44">44</option>
        <option value="45">45</option>
        <option value="46">46</option>
        <option value="47">47</option>
        <option value="48">48</option>
        <option value="49">49</option>
        <option value="50">50</option>
        <option value="51">51: Best Buddy</option>
        <option value="52">52 (SPECULATIVE)</option>
        <option value="53">53 (SPECULATIVE)</option>
        <option value="54">54 (SPECULATIVE)</option>
        <option value="55">55 (SPECULATIVE)</option>
      </select></div>
      <div><label id="searchLvlLbl">Search Levels:</label><select title="What Level CPs/HPs to Search for?" id="searchLvl" oninput="main()">
        <option value="29,28,27,26,25,24,23,22,21,20,19,18,17,16,15,14,13,12,11,10,9,8,7,6,5,4,3,2,1">1-29 (Wild Caught, Except L30)</option>
        <option value="30,29,28,27,26,25,24,23,22,21,20,19,18,17,16,15,14,13,12,11,10,9,8,7,6,5,4,3,2,1" selected>Wild Caught (1-30)</option>
        <option value="35,34,33,32,31,30,29,28,27,26,25,24,23,22,21,20,19,18,17,16,15,14,13,12,11,10,9,8,7,6,5,4,3,2,1">Weather Boosted (1-35)</option>
        <option value="34,33,32,31,30,29,28,27,26,25,24,23,22,21,20,19,18,17,16,15,14,13,12,11,10,9,8,7,6,5,4,3,2,1">1-34 (WB, Except L35)</option>
        <option value="33,32,31,30,29,28,27,26,25,24,23,22,21,20,19,18,17,16,15,14,13,12,11,10,9,8,7,6,5,4,3,2,1">1-33 (WB, Except L34, L35)</option>
        <option value="25,20,15">Raid/Quest (15,20,25)</option>
        <option value="15">Only Quest (15)</option>
      </select></div>
      <br /><div id=overflowArea></div>
    <div style="overflow-x:auto;"><br />
      <p style="color:silver;font-size:0.6em">This site uses Google Analytics and the Google
      <a style="color:#AED6F1" href="https://policies.google.com/privacy">Privacy Policy</a> and
      <a style="color:#AED6F1" href="https://policies.google.com/terms">Terms of Service</a> apply.</p>
    </div>
    </section>
  </body>
</html>